!function t(e,i,n){function s(o,a){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[o]={exports:{}};e[o][0].call(u.exports,function(t){var i=e[o][1][t];return s(i?i:t)},u,u.exports,t,e,i,n)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(t,e,i){var n=t("./core.js"),s=(window.document,t("./HashMap.js"));n._rectPool=function(){var t=[],e=0;return{get:function(i,n,s,r){t.length<=e&&t.push({});var o=t[e++];return o._x=i,o._y=n,o._w=s,o._h=r,o},copy:function(i){t.length<=e&&t.push({});var n=t[e++];return n._x=i._x,n._y=i._y,n._w=i._w,n._h=i._h,n},recycle:function(t){e--}}}(),n.map=new s;var r=Math,o=(r.cos,r.sin,r.PI),a=o/180;n.extend({zeroFill:function(t,e){return e-=t.toString().length,e>0?new Array(e+(/\./.test(t)?2:1)).join("0")+t:t.toString()}}),n.c("2D",{_x:0,_y:0,_w:0,_h:0,_z:0,_rotation:0,_alpha:1,_visible:!0,_globalZ:null,_origin:null,_mbr:null,_entry:null,_children:null,_parent:null,_changed:!1,_define2DProperties:function(){Object.defineProperty(this,"x",{set:function(t){this._attr("_x",t)},get:function(){return this._x},configurable:!0,enumerable:!0}),Object.defineProperty(this,"_x",{enumerable:!1}),Object.defineProperty(this,"y",{set:function(t){this._attr("_y",t)},get:function(){return this._y},configurable:!0,enumerable:!0}),Object.defineProperty(this,"_y",{enumerable:!1}),Object.defineProperty(this,"w",{set:function(t){this._attr("_w",t)},get:function(){return this._w},configurable:!0,enumerable:!0}),Object.defineProperty(this,"_w",{enumerable:!1}),Object.defineProperty(this,"h",{set:function(t){this._attr("_h",t)},get:function(){return this._h},configurable:!0,enumerable:!0}),Object.defineProperty(this,"_h",{enumerable:!1}),Object.defineProperty(this,"z",{set:function(t){this._attr("_z",t)},get:function(){return this._z},configurable:!0,enumerable:!0}),Object.defineProperty(this,"_z",{enumerable:!1}),Object.defineProperty(this,"rotation",{set:function(t){this._attr("_rotation",t)},get:function(){return this._rotation},configurable:!0,enumerable:!0}),Object.defineProperty(this,"_rotation",{enumerable:!1}),Object.defineProperty(this,"alpha",{set:function(t){this._attr("_alpha",t)},get:function(){return this._alpha},configurable:!0,enumerable:!0}),Object.defineProperty(this,"_alpha",{enumerable:!1}),Object.defineProperty(this,"visible",{set:function(t){this._attr("_visible",t)},get:function(){return this._visible},configurable:!0,enumerable:!0}),Object.defineProperty(this,"_visible",{enumerable:!1})},init:function(){this._globalZ=this[0],this._origin={x:0,y:0},this._bx1=0,this._bx2=0,this._by1=0,this._by2=0,this._children=[],this._define2DProperties(),this._entry=n.map.insert(this),this.bind("Move",function(t){var e=this._cbr||this._mbr||this;this._entry.update(e),this._children.length>0&&this._cascade(t)}),this.bind("Rotate",function(t){var e=this._cbr||this._mbr||this;this._entry.update(e),this._children.length>0&&this._cascade(t)}),this.bind("Remove",function(){if(this._children){for(var t=0;t<this._children.length;t++)delete this._children[t]._parent,this._children[t].destroy&&this._children[t].destroy();this._children=[]}this._parent&&this._parent.detach(this),n.map.remove(this),this.detach()})},offsetBoundary:function(t,e,i,n){return 1===arguments.length&&(e=i=n=t),this._bx1=t,this._bx2=i,this._by1=e,this._by2=n,this.trigger("BoundaryOffset"),this._calculateMBR(),this},_calculateMBR:function(){var t=this._origin.x+this._x,e=this._origin.y+this._y,i=-this._rotation*a,n=this._x-this._bx1-t,s=this._x+this._w+this._bx2-t,r=this._y-this._by1-e,o=this._y+this._h+this._by2-e,h=Math.cos(i),c=Math.sin(i);h=1e-10>h&&h>-1e-10?0:h,c=1e-10>c&&c>-1e-10?0:c;var u=n*h+r*c,l=-n*c+r*h,d=s*h+r*c,_=-s*c+r*h,f=s*h+o*c,p=-s*c+o*h,g=n*h+o*c,m=-n*c+o*h,y=Math.floor(Math.min(u,d,f,g)+t),v=Math.floor(Math.min(l,_,p,m)+e),x=Math.ceil(Math.max(u,d,f,g)+t),w=Math.ceil(Math.max(l,_,p,m)+e);if(this._mbr?(this._mbr._x=y,this._mbr._y=v,this._mbr._w=x-y,this._mbr._h=w-v):this._mbr={_x:y,_y:v,_w:x-y,_h:w-v},this._cbr){var b=this._cbr,M=b.cx,D=b.cy,C=b.r,R=t+(M+this._x-t)*h+(D+this._y-e)*c,E=e-(M+this._x-t)*c+(D+this._y-e)*h;b._x=Math.min(R-C,y),b._y=Math.min(E-C,v),b._w=Math.max(R+C,x)-b._x,b._h=Math.max(E+C,w)-b._y}},_rotate:function(t){var e=-1*(t%360),i=this._rotation-t;if(0!==i){this._rotation=t;var n=e*a,s={x:this._origin.x+this._x,y:this._origin.y+this._y};this._calculateMBR();var r=i*a;Math.cos(n),Math.sin(n);this.trigger("Rotate",{cos:Math.cos(r),sin:Math.sin(r),deg:i,rad:r,o:s})}},area:function(){return this._w*this._h},intersect:function(t,e,i,n){var s,r=this._mbr||this;return s="object"==typeof t?t:{x:t,y:e,w:i,h:n},r._x<s.x+s.w&&r._x+r._w>s.x&&r._y<s.y+s.h&&r._h+r._y>s.y},within:function(t,e,i,n){var s,r=this._mbr||this;return s="object"==typeof t?t:{_x:t,_y:e,_w:i,_h:n},s._x<=r._x&&s._x+s._w>=r._x+r._w&&s._y<=r._y&&s._y+s._h>=r._y+r._h},contains:function(t,e,i,n){var s,r=this._mbr||this;return s="object"==typeof t?t:{_x:t,_y:e,_w:i,_h:n},s._x>=r._x&&s._x+s._w<=r._x+r._w&&s._y>=r._y&&s._y+s._h<=r._y+r._h},pos:function(){return{_x:this._x,_y:this._y,_w:this._w,_h:this._h}},mbr:function(){return this._mbr?{_x:this._mbr._x,_y:this._mbr._y,_w:this._mbr._w,_h:this._mbr._h}:this.pos()},isAt:function(t,e){if(this.mapArea)return this.mapArea.containsPoint(t,e);if(this.map)return this.map.containsPoint(t,e);var i=this._mbr||this;return i._x<=t&&i._x+i._w>=t&&i._y<=e&&i._y+i._h>=e},move:function(t,e){return"n"===t.charAt(0)&&(this.y-=e),"s"===t.charAt(0)&&(this.y+=e),("e"===t||"e"===t.charAt(1))&&(this.x+=e),("w"===t||"w"===t.charAt(1))&&(this.x-=e),this},shift:function(t,e,i,n){return t&&(this.x+=t),e&&(this.y+=e),i&&(this.w+=i),n&&(this.h+=n),this},_cascade:function(t){if(t){var e,i=0,n=this._children,s=n.length;if("cos"in t||"sin"in t)for(;s>i;++i)e=n[i],"rotate"in e&&e.rotate(t);else for(var r=this._x-t._x,o=this._y-t._y,a=this._w-t._w,h=this._h-t._h;s>i;++i)e=n[i],e.shift(r,o,a,h)}},attach:function(){for(var t,e=0,i=arguments,n=arguments.length;n>e;++e)t=i[e],t._parent&&t._parent.detach(t),t._parent=this,this._children.push(t);return this},detach:function(t){var e;if(!t){for(e=0;e<this._children.length;e++)this._children[e]._parent=null;return this._children=[],this}for(e=0;e<this._children.length;e++)this._children[e]==t&&this._children.splice(e,1);return t._parent=null,this},origin:function(t,e){if("string"==typeof t)if("centre"===t||"center"===t||-1===t.indexOf(" "))t=this._w/2,e=this._h/2;else{var i=t.split(" ");"top"===i[0]?e=0:"bottom"===i[0]?e=this._h:("middle"===i[0]||"center"===i[1]||"centre"===i[1])&&(e=this._h/2),"center"===i[1]||"centre"===i[1]||"middle"===i[1]?t=this._w/2:"left"===i[1]?t=0:"right"===i[1]&&(t=this._w)}return this._origin.x=t,this._origin.y=e,this},flip:function(t){return t=t||"X",this["_flip"+t]||(this["_flip"+t]=!0,this.trigger("Invalidate")),this},unflip:function(t){return t=t||"X",this["_flip"+t]&&(this["_flip"+t]=!1,this.trigger("Invalidate")),this},rotate:function(t){var e,i;e=(this._x+this._origin.x-t.o.x)*t.cos+(this._y+this._origin.y-t.o.y)*t.sin+(t.o.x-this._origin.x),i=(this._y+this._origin.y-t.o.y)*t.cos-(this._x+this._origin.x-t.o.x)*t.sin+(t.o.y-this._origin.y),this._attr("_rotation",this._rotation-t.deg),this._attr("_x",e),this._attr("_y",i)},_attr:function(t,e){if(this[t]!==e){var i,s=n._rectPool.copy(this);if("_rotation"===t)this._rotate(e);else if("_z"===t)this._globalZ=parseInt(e+n.zeroFill(this[0],5),10),this.trigger("reorder");else if("_x"===t||"_y"===t)i=this._mbr,i&&(i[t]-=this[t]-e,this._cbr&&(this._cbr[t]-=this[t]-e)),this[t]=e,this.trigger("Move",s);else if("_h"===t||"_w"===t){i=this._mbr;var r=this[t];this[t]=e,i&&this._calculateMBR(),"_w"===t?this.trigger("Resize",{axis:"w",amount:e-r}):"_h"===t&&this.trigger("Resize",{axis:"h",amount:e-r}),this.trigger("Move",s)}this[t]=e,this.trigger("Invalidate"),n._rectPool.recycle(s)}}}),n.c("Gravity",{_gravityConst:.2,_gy:0,_falling:!0,_anti:null,init:function(){this.requires("2D")},gravity:function(t){return t&&(this._anti=t),isNaN(this._jumpSpeed)&&(this._jumpSpeed=0),this.bind("EnterFrame",this._enterFrame),this},gravityConst:function(t){return this._gravityConst=t,this},_enterFrame:function(){this._falling?(this._gy+=this._gravityConst,this.y+=this._gy,this.trigger("Moved",{x:this._x,y:this._y-this._gy})):this._gy=0;var t,e,i,s=!1,r=this.pos(),o=0;for(r._y++,r.x=r._x,r.y=r._y,r.w=r._w,r.h=r._h,e=n.map.search(r),i=e.length;i>o;++o)if(t=e[o],t!==this&&t.has(this._anti)&&t.intersect(r)){s=t;break}s?this._falling&&(this._gy>this._jumpSpeed||!this._up)&&this.stopFalling(s):this._falling=!0},stopFalling:function(t){t&&(this.y=t._y-this._h),this._falling=!1,this._up&&(this._up=!1),this.trigger("hit")},antigravity:function(){this.unbind("EnterFrame",this._enterFrame)}}),n.polygon=function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments,0)),this.points=t},n.polygon.prototype={containsPoint:function(t,e){var i,n,s=this.points,r=!1;for(i=0,n=s.length-1;i<s.length;n=i++)s[i][1]>e!=s[n][1]>e&&t<(s[n][0]-s[i][0])*(e-s[i][1])/(s[n][1]-s[i][1])+s[i][0]&&(r=!r);return r},shift:function(t,e){for(var i,n=0,s=this.points.length;s>n;n++)i=this.points[n],i[0]+=t,i[1]+=e},rotate:function(t){for(var e,i,n,s=0,r=this.points.length;r>s;s++)e=this.points[s],i=t.o.x+(e[0]-t.o.x)*t.cos+(e[1]-t.o.y)*t.sin,n=t.o.y-(e[0]-t.o.x)*t.sin+(e[1]-t.o.y)*t.cos,e[0]=i,e[1]=n}},n.circle=function(t,e,i){this.x=t,this.y=e,this.radius=i,this.points=[];for(var n,s=0;8>s;s++)n=s*Math.PI/4,this.points[s]=[this.x+Math.sin(n)*i,this.y+Math.cos(n)*i]},n.circle.prototype={containsPoint:function(t,e){var i=this.radius,n=(Math.sqrt,this.x-t),s=this.y-e;return i*i>n*n+s*s},shift:function(t,e){this.x+=t,this.y+=e;for(var i,n=0,s=this.points.length;s>n;n++)i=this.points[n],i[0]+=t,i[1]+=e},rotate:function(){}},n.matrix=function(t){this.mtx=t,this.width=t[0].length,this.height=t.length},n.matrix.prototype={x:function(t){if(this.width==t.height){for(var e=[],i=0;i<this.height;i++){e[i]=[];for(var s=0;s<t.width;s++){for(var r=0,o=0;o<this.width;o++)r+=this.mtx[i][o]*t.mtx[o][s];e[i][s]=r}}return new n.matrix(e)}},e:function(t,e){return 1>t||t>this.mtx.length||1>e||e>this.mtx[0].length?null:this.mtx[t-1][e-1]}}},{"./HashMap.js":4,"./core.js":10}],2:[function(t,e,i){var n=t("./core.js"),s=window.document;n.c("DOM",{_element:null,_cssStyles:null,avoidCss3dTransforms:!1,init:function(){this._cssStyles={visibility:"",left:"",top:"",width:"",height:"",zIndex:"",opacity:"",transformOrigin:"",transform:""},this._element=s.createElement("div"),n.stage.inner.appendChild(this._element),this._element.style.position="absolute",this._element.id="ent"+this[0],this.bind("Invalidate",this._invalidateDOM),this.bind("NewComponent",this._updateClass),this.bind("RemoveComponent",this._removeClass),this._invalidateDOM()},remove:function(){this.undraw(),this.unbind("NewComponent",this._updateClass),this.unbind("RemoveComponent",this._removeClass),this.unbind("Invalidate",this._invalidateDOM)},getDomId:function(){return this._element.id},_removeClass:function(t){var e=0,i=this.__c,n="";for(e in i)e!=t&&(n+=" "+e);n=n.substr(1),this._element.className=n},_updateClass:function(){var t=0,e=this.__c,i="";for(t in e)i+=" "+t;i=i.substr(1),this._element.className=i},_invalidateDOM:function(){this._changed||(this._changed=!0,n.DrawManager.addDom(this))},DOM:function(t){return t&&t.nodeType&&(this.undraw(),this._element=t,this._element.style.position="absolute"),this},draw:function(){var t=this._element.style,e=this.__coord||[0,0,0,0],i={x:e[0],y:e[1],w:e[2],h:e[3]},s=n.support.prefix,r=[];if(this._cssStyles.visibility!==this._visible&&(this._cssStyles.visibility=this._visible,this._visible?t.visibility="visible":t.visibility="hidden"),n.support.css3dtransform&&!this.avoidCss3dTransforms?r.push("translate3d("+~~this._x+"px,"+~~this._y+"px,0)"):(this._cssStyles.left!==this._x&&(this._cssStyles.left=this._x,t.left=~~this._x+"px"),this._cssStyles.top!==this._y&&(this._cssStyles.top=this._y,t.top=~~this._y+"px")),this._cssStyles.width!==this._w&&(this._cssStyles.width=this._w,t.width=~~this._w+"px"),this._cssStyles.height!==this._h&&(this._cssStyles.height=this._h,t.height=~~this._h+"px"),this._cssStyles.zIndex!==this._z&&(this._cssStyles.zIndex=this._z,t.zIndex=this._z),this._cssStyles.opacity!==this._alpha&&(this._cssStyles.opacity=this._alpha,t.opacity=this._alpha,t[s+"Opacity"]=this._alpha),this._mbr){var o=this._origin.x+"px "+this._origin.y+"px";t.transformOrigin=o,t[s+"TransformOrigin"]=o,n.support.css3dtransform?r.push("rotateZ("+this._rotation+"deg)"):r.push("rotate("+this._rotation+"deg)")}return this._flipX&&r.push("scaleX(-1)"),this._flipY&&r.push("scaleY(-1)"),this._cssStyles.transform!=r.join(" ")&&(this._cssStyles.transform=r.join(" "),t.transform=this._cssStyles.transform,t[s+"Transform"]=this._cssStyles.transform),this.trigger("Draw",{style:t,type:"DOM",co:i}),this},undraw:function(){var t=this._element;return t&&null!==t.parentNode&&t.parentNode.removeChild(t),this},css:function(t,e){var i,s,r=this._element,o=r.style;if("object"==typeof t)for(i in t)t.hasOwnProperty(i)&&(s=t[i],"number"==typeof s&&(s+="px"),o[n.DOM.camelize(i)]=s);else{if(!e)return n.DOM.getStyle(r,t);"number"==typeof e&&(e+="px"),o[n.DOM.camelize(t)]=e}return this.trigger("Invalidate"),this}}),n.extend({DOM:{window:{init:function(){this.width=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,this.height=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,n.uniqueBind("RenderScene",n.DrawManager.renderDOM),n.uniqueBind("ViewportResize",this._resize),n.uniqueBind("PixelartSet",this._setPixelArt)},_resize:function(){n.stage.elem.style.width=n.viewport.width+"px",n.stage.elem.style.height=n.viewport.height+"px"},_setPixelArt:function(t){var e=n.stage.inner.style;t?(e[n.DOM.camelize("image-rendering")]="optimizeSpeed",e[n.DOM.camelize("image-rendering")]="-moz-crisp-edges",e[n.DOM.camelize("image-rendering")]="-o-crisp-edges",e[n.DOM.camelize("image-rendering")]="-webkit-optimize-contrast",e[n.DOM.camelize("-ms-interpolation-mode")]="nearest-neighbor",e[n.DOM.camelize("image-rendering")]="optimize-contrast",e[n.DOM.camelize("image-rendering")]="pixelated",e[n.DOM.camelize("image-rendering")]="crisp-edges"):(e[n.DOM.camelize("image-rendering")]="optimizeQuality",e[n.DOM.camelize("-ms-interpolation-mode")]="bicubic",e[n.DOM.camelize("image-rendering")]="auto")},width:0,height:0},inner:function(t){var e=t.getBoundingClientRect(),i=e.left+(window.pageXOffset?window.pageXOffset:s.body.scrollLeft),n=e.top+(window.pageYOffset?window.pageYOffset:s.body.scrollTop),r=parseInt(this.getStyle(t,"border-left-width")||0,10)||parseInt(this.getStyle(t,"borderLeftWidth")||0,10)||0,o=parseInt(this.getStyle(t,"border-top-width")||0,10)||parseInt(this.getStyle(t,"borderTopWidth")||0,10)||0;return i+=r,n+=o,{x:i,y:n}},getStyle:function(t,e){var i;return t.currentStyle?i=t.currentStyle[this.camelize(e)]:window.getComputedStyle&&(i=s.defaultView.getComputedStyle(t,null).getPropertyValue(this.csselize(e))),i},camelize:function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},csselize:function(t){return t.replace(/[A-Z]/g,function(t){return t?"-"+t.toLowerCase():""})},translate:function(t,e){var i=s.documentElement,r=s.body;return{x:(t-n.stage.x+(i&&i.scrollLeft||r&&r.scrollLeft||0))/n.viewport._scale-n.viewport._x,y:(e-n.stage.y+(i&&i.scrollTop||r&&r.scrollTop||0))/n.viewport._scale-n.viewport._y}}}})},{"./core.js":10}],3:[function(t,e,i){var n=t("./core.js"),s=window.document;n.c("DebugCanvas",{init:function(){this.requires("2D"),n.DebugCanvas.context||n.DebugCanvas.init(),n.DebugCanvas.add(this),this._debug={alpha:1,lineWidth:1},this.bind("RemoveComponent",this.onDebugRemove),this.bind("Remove",this.onDebugDestroy)},onDebugRemove:function(t){"DebugCanvas"===t&&n.DebugCanvas.remove(this)},onDebugDestroy:function(t){n.DebugCanvas.remove(this)},debugAlpha:function(t){return this._debug.alpha=t,this},debugFill:function(t){return"undefined"==typeof t&&(t="red"),this._debug.fillStyle=t,this},debugStroke:function(t){return"undefined"==typeof t&&(t="red"),this._debug.strokeStyle=t,this},debugDraw:function(t){var e=t.globalAlpha,i=this._debug;i.alpha&&(t.globalAlpha=this._debug.alpha),i.strokeStyle&&(t.strokeStyle=i.strokeStyle),i.lineWidth&&(t.lineWidth=i.lineWidth),i.fillStyle&&(t.fillStyle=i.fillStyle),this.trigger("DebugDraw"),t.globalAlpha=e}}),n.c("DebugRectangle",{init:function(){this.requires("2D, DebugCanvas")},debugRectangle:function(t){return this.debugRect=t,this.unbind("DebugDraw",this.drawDebugRect),this.bind("DebugDraw",this.drawDebugRect),this},drawDebugRect:function(){ctx=n.DebugCanvas.context;var t=this.debugRect;null!==t&&void 0!==t&&t._h&&t._w&&(this._debug.fillStyle&&ctx.fillRect(t._x,t._y,t._w,t._h),this._debug.strokeStyle&&ctx.strokeRect(t._x,t._y,t._w,t._h))}}),n.c("VisibleMBR",{init:function(){this.requires("DebugRectangle").debugFill("purple").bind("EnterFrame",this._assignRect)},_assignRect:function(){this._mbr?this.debugRectangle(this._mbr):this.debugRectangle(this)}}),n.c("DebugPolygon",{init:function(){this.requires("2D, DebugCanvas")},debugPolygon:function(t){return this.polygon=t,this.unbind("DebugDraw",this.drawDebugPolygon),this.bind("DebugDraw",this.drawDebugPolygon),this},drawDebugPolygon:function(){if("undefined"!=typeof this.polygon){ctx=n.DebugCanvas.context,ctx.beginPath();for(var t in this.polygon.points)ctx.lineTo(this.polygon.points[t][0],this.polygon.points[t][1]);ctx.closePath(),this._debug.fillStyle&&ctx.fill(),this._debug.strokeStyle&&ctx.stroke()}}}),n.c("WiredHitBox",{init:function(){this.requires("DebugPolygon").debugStroke("red").matchHitBox(),this.bind("NewHitbox",this.matchHitBox)},matchHitBox:function(){this.debugPolygon(this.map)}}),n.c("SolidHitBox",{init:function(){this.requires("Collision, DebugPolygon").debugFill("orange").debugAlpha(.7).matchHitBox(),this.bind("NewHitbox",this.matchHitBox)},matchHitBox:function(){this.debugPolygon(this.map)}}),n.DebugCanvas={context:null,entities:[],onetimeEntities:[],add:function(t){this.entities.push(t)},remove:function(t){for(var e=this.entities,i=e.length-1;i>=0;i--)e[i]==t&&e.splice(i,1)},init:function(){if(!n.DebugCanvas.context){if(!n.support.canvas)return n.trigger("NoCanvas"),void n.stop();var t;t=s.createElement("canvas"),t.width=n.viewport.width,t.height=n.viewport.height,t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.id="debug-canvas",t.style.zIndex=1e5,n.stage.elem.appendChild(t),n.DebugCanvas.context=t.getContext("2d"),n.DebugCanvas._canvas=t}n.unbind("RenderScene",n.DebugCanvas.renderScene),n.bind("RenderScene",n.DebugCanvas.renderScene)},renderScene:function(t){t=t||n.viewport.rect();var e,i=n.DebugCanvas.entities,s=0,r=i.length,o=n.DebugCanvas.context,a=n.viewport;for(o.setTransform(a._scale,0,0,a._scale,Math.round(a._x*a._scale),Math.round(a._y*a._scale)),o.clearRect(t._x,t._y,t._w,t._h);r>s;s++)e=i[s],e.debugDraw(o)}}},{"./core.js":10}],4:[function(t,e,i){function n(t,e,i){this.keys=t,this.map=i,this.obj=e}var s,r=(t("./core.js"),window.document,function(t){s=t||64,this.map={}}),o=" ",a={};r.prototype={insert:function(t){var e,i,s=r.key(t),o=new n(s,t,this),a=0;for(a=s.x1;a<=s.x2;a++)for(e=s.y1;e<=s.y2;e++)i=a<<16^e,this.map[i]||(this.map[i]=[]),this.map[i].push(t);return o},search:function(t,e){var i,n,s,o=r.key(t,a),h=[];for(void 0===e&&(e=!0),i=o.x1;i<=o.x2;i++)for(n=o.y1;n<=o.y2;n++)if(cell=this.map[i<<16^n],cell)for(s=0;s<cell.length;s++)h.push(cell[s]);if(e){var c,u,d=[],_={};for(i=0,l=h.length;i<l;i++)c=h[i],c&&(u=c[0],c=c._mbr||c,!_[u]&&c._x<t._x+t._w&&c._x+c._w>t._x&&c._y<t._y+t._h&&c._h+c._y>t._y&&(_[u]=h[i]));for(c in _)d.push(_[c]);return d}return h},remove:function(t,e){var i,n,s=0;for(1==arguments.length&&(e=t,t=r.key(e,a)),s=t.x1;s<=t.x2;s++)for(i=t.y1;i<=t.y2;i++)if(n=s<<16^i,this.map[n]){var o,h=this.map[n],c=h.length;for(o=0;c>o;o++)h[o]&&h[o][0]===e[0]&&h.splice(o,1)}},refresh:function(t){var e,i,n,s,o,a=t.keys,h=t.obj;for(i=a.x1;i<=a.x2;i++)for(n=a.y1;n<=a.y2;n++)if(e=this.map[i<<16^n])for(o=e.length,s=0;o>s;s++)e[s]&&e[s][0]===h[0]&&e.splice(s,1);for(r.key(h,a),i=a.x1;i<=a.x2;i++)for(n=a.y1;n<=a.y2;n++)e=this.map[i<<16^n],e||(e=this.map[i<<16^n]=[]),e.push(h);return t},boundaries:function(){var t,e,i={max:{x:-(1/0),y:-(1/0)},min:{x:1/0,y:1/0}},n={max:{x:-(1/0),y:-(1/0)},min:{x:1/0,y:1/0}};for(var s in this.map)if(this.map[s].length){var r=s>>16,o=s<<16>>16;if(0>o&&(r=-1^r),r>=i.max.x){i.max.x=r;for(t in this.map[s])e=this.map[s][t],"object"==typeof e&&"requires"in e&&(n.max.x=Math.max(n.max.x,e.x+e.w))}if(r<=i.min.x){i.min.x=r;for(t in this.map[s])e=this.map[s][t],"object"==typeof e&&"requires"in e&&(n.min.x=Math.min(n.min.x,e.x))}if(o>=i.max.y){i.max.y=o;for(t in this.map[s])e=this.map[s][t],"object"==typeof e&&"requires"in e&&(n.max.y=Math.max(n.max.y,e.y+e.h))}if(o<=i.min.y){i.min.y=o;for(t in this.map[s])e=this.map[s][t],"object"==typeof e&&"requires"in e&&(n.min.y=Math.min(n.min.y,e.y))}}return n}},r.key=function(t,e){return t._mbr&&(t=t._mbr),e||(e={}),e.x1=Math.floor(t._x/s),e.y1=Math.floor(t._y/s),e.x2=Math.floor((t._w+t._x)/s),e.y2=Math.floor((t._h+t._y)/s),e},r.hash=function(t){return t.x1+o+t.y1+o+t.x2+o+t.y2},n.prototype={update:function(t){r.hash(r.key(t,a))!=r.hash(this.keys)&&this.map.refresh(this)}},e.exports=r},{"./core.js":10}],5:[function(t,e,i){var n=t("./core.js");window.document;n.easing=function(t){this.timePerFrame=1e3/n.timer.FPS(),this.duration=t,this.reset()},n.easing.prototype={duration:0,clock:0,steps:null,complete:!1,paused:!1,reset:function(){this.loops=1,this.clock=0,this.complete=!1,this.paused=!1},repeat:function(t){this.loops=t},setProgress:function(t,e){this.clock=this.duration*t,"undefined"!=typeof e&&(this.loops=e)},pause:function(){this.paused=!0},resume:function(){this.paused=!1,this.complete=!1},tick:function(t){if(!this.paused&&!this.complete)for(this.clock+=t,this.frames=Math.floor(this.clock/this.timePerFrame);this.clock>=this.duration&&this.complete===!1;)this.loops--,this.loops>0?this.clock-=this.duration:this.complete=!0},time:function(){return Math.min(this.clock/this.duration,1)},value:function(){return this.time()}},n.c("Tween",{init:function(){this.tweenGroup={},this.tweenStart={},this.tweens=[],this.bind("EnterFrame",this._tweenTick)},_tweenTick:function(t){var e,i,n;for(n=this.tweens.length-1;n>=0;n--)e=this.tweens[n],e.easing.tick(t.dt),i=e.easing.value(),this._doTween(e.props,i),e.easing.complete&&(this.tweens.splice(n,1),this._endTween(e.props))},_doTween:function(t,e){for(var i in t)this[i]=(1-e)*this.tweenStart[i]+e*t[i]},tween:function(t,e){var i={props:t,easing:new n.easing(e)};for(var s in t)"undefined"!=typeof this.tweenGroup[s]&&this.cancelTween(s),this.tweenStart[s]=this[s],this.tweenGroup[s]=t;return this.tweens.push(i),this},cancelTween:function(t){if("string"==typeof t)"object"==typeof this.tweenGroup[t]&&delete this.tweenGroup[t][t];else if("object"==typeof t)for(var e in t)this.cancelTween(e);return this},_endTween:function(t){for(var e in t)delete this.tweenGroup[e];this.trigger("TweenEnd",t)}})},{"./core.js":10}],6:[function(t,e,i){var n=t("./core.js"),s=window.document;n.c("Canvas",{init:function(){n.canvas.context||n.canvas.init(),n.DrawManager.total2D++,this.currentRect={},this._changed=!0,n.DrawManager.addCanvas(this),this.bind("Invalidate",function(t){this._changed===!1&&(this._changed=!0,n.DrawManager.addCanvas(this))}),this.bind("Remove",function(){n.DrawManager.total2D--,this._changed=!0,n.DrawManager.addCanvas(this)})},drawVars:{type:"canvas",pos:{},ctx:null,coord:[0,0,0,0],co:{x:0,y:0,w:0,h:0}},draw:function(t,e,i,s,r){if(this.ready){4===arguments.length&&(r=s,s=i,i=e,e=t,t=n.canvas.context);var o=this.drawVars.pos;o._x=this._x+(e||0),o._y=this._y+(i||0),o._w=s||this._w,o._h=r||this._h,context=t||n.canvas.context,coord=this.__coord||[0,0,0,0];var a=this.drawVars.co;a.x=coord[0]+(e||0),a.y=coord[1]+(i||0),a.w=s||coord[2],a.h=r||coord[3],0!==this._rotation&&(context.save(),context.translate(this._origin.x+this._x,this._origin.y+this._y),o._x=-this._origin.x,o._y=-this._origin.y,context.rotate(this._rotation%360*(Math.PI/180))),(this._flipX||this._flipY)&&(context.save(),context.scale(this._flipX?-1:1,this._flipY?-1:1),this._flipX&&(o._x=-(o._x+o._w)),this._flipY&&(o._y=-(o._y+o._h)));var h;return this._alpha<1&&(h=context.globalAlpha,context.globalAlpha=this._alpha),this.drawVars.ctx=context,this.trigger("Draw",this.drawVars),(0!==this._rotation||this._flipX||this._flipY)&&context.restore(),h&&(context.globalAlpha=h),this}}}),n.extend({canvas:{context:null,init:function(){if(!n.support.canvas)return n.trigger("NoCanvas"),void n.stop();var t;t=s.createElement("canvas"),t.width=n.viewport.width,t.height=n.viewport.height,t.style.position="absolute",t.style.left="0px",t.style.top="0px",n.stage.elem.appendChild(t),n.canvas.context=t.getContext("2d"),n.canvas._canvas=t;var e=n.viewport._scale;1!=e&&n.canvas.context.scale(e,e),this._setPixelart(n._pixelartEnabled),n.uniqueBind("PixelartSet",this._setPixelart),n.uniqueBind("RenderScene",n.DrawManager.renderCanvas),n.uniqueBind("ViewportResize",this._resize)},_resize:function(){var t=n.canvas._canvas;t.width=n.viewport.width,t.height=n.viewport.height},_setPixelart:function(t){var e=n.canvas.context;e.imageSmoothingEnabled=!t,e.mozImageSmoothingEnabled=!t,e.webkitImageSmoothingEnabled=!t,e.oImageSmoothingEnabled=!t,e.msImageSmoothingEnabled=!t}}})},{"./core.js":10}],7:[function(t,e,i){var n=t("./core.js"),s=(window.document,Math.PI/180);n.c("Collision",{init:function(){this.requires("2D"),this._collisionData={},this.collision()},remove:function(){this._cbr=null,this.unbind("Resize",this._resizeMap),this.unbind("Resize",this._checkBounds)},collision:function(t){if(this.unbind("Resize",this._resizeMap),this.unbind("Resize",this._checkBounds),t){if(arguments.length>1){var e=Array.prototype.slice.call(arguments,0);t=new n.polygon(e)}this._findBounds(t.points)}else t=new n.polygon([0,0],[this._w,0],[this._w,this._h],[0,this._h]),this.bind("Resize",this._resizeMap),this._cbr=null;return this.rotation&&t.rotate({cos:Math.cos(-this.rotation*s),sin:Math.sin(-this.rotation*s),o:{x:this._origin.x,y:this._origin.y}}),this.map=t,this.attach(this.map),this.map.shift(this._x,this._y),this.trigger("NewHitbox",t),this},_findBounds:function(t){for(var e,i=1/0,n=-(1/0),s=1/0,r=-(1/0),o=0;o<t.length;++o)e=t[o],e[0]<i&&(i=e[0]),e[0]>n&&(n=e[0]),e[1]<s&&(s=e[1]),e[1]>r&&(r=e[1]);var a={cx:(i+n)/2,cy:(s+r)/2,r:Math.sqrt((n-i)*(n-i)+(r-s)*(r-s))/2};return i>=0&&s>=0&&(this._checkBounds=function(){null===this._cbr&&this._w<n||this._h<r?(this._cbr=a,this._calculateMBR()):this._cbr&&(this._cbr=null,this._calculateMBR())},this.bind("Resize",this._checkBounds)),i>=0&&s>=0&&n<=this._w&&r<=this._h?(this._cbr=null,!1):(this._cbr=a,this._calculateMBR(),!0)},_resizeMap:function(t){var e,i,n=this.rotation*s,r=this.map.points;"w"===t.axis?(n?(e=t.amount*Math.cos(n),i=t.amount*Math.sin(n)):(e=t.amount,i=0),r[1][0]+=e,r[1][1]+=i):(n?(i=t.amount*Math.cos(n),e=-t.amount*Math.sin(n)):(e=0,i=t.amount),r[3][0]+=e,r[3][1]+=i),r[2][0]+=e,r[2][1]+=i},hit:function(t){var e,i,s,r,o=this._cbr||this._mbr||this,a=n.map.search(o,!1),h=0,c=a.length,u={},l="map"in this&&"containsPoint"in this.map,d=[];if(!c)return!1;for(;c>h;++h)i=a[h],s=i._cbr||i._mbr||i,i&&(e=i[0],!u[e]&&this[0]!==e&&i.__c[t]&&s._x<o._x+o._w&&s._x+s._w>o._x&&s._y<o._y+o._h&&s._h+s._y>o._y&&(u[e]=i));for(r in u)if(i=u[r],l&&"map"in i){var _=this._SAT(this.map,i.map);_.obj=i,_.type="SAT",_&&d.push(_)}else d.push({obj:i,type:"MBR"});return d.length?d:!1},onHit:function(t,e,i){var n=!1;return this.bind("EnterFrame",function(){var s=this.hit(t);s?(n=!0,e.call(this,s)):n&&("function"==typeof i&&i.call(this),n=!1)}),this},_createCollisionHandler:function(t,e){return function(){var i=this.hit(t);if(e.occurring===!0){if(i!==!1)return;e.occurring=!1,this.trigger("HitOff",t)}else i!==!1&&(e.occurring=!0,this.trigger("HitOn",i))}},checkHits:function(){var t=arguments,e=0;for(1===t.length&&(t=t[0].split(/\s*,\s*/));e<t.length;++e){var i=t[e],n=this._collisionData[i];void 0===n&&(this._collisionData[i]=n={occurring:!1,handler:null},n.handler=this._createCollisionHandler(i,n),this.bind("EnterFrame",n.handler))}return this},ignoreHits:function(){var t,e=arguments,i=0;if(0===e.length){for(t in this._collisionData)this.unbind("EnterFrame",t.handler);this._collisionData={}}for(1===e.length&&(e=e[0].split(/\s*,\s*/));i<e.length;++i){var n=e[i];t=this._collisionData[n],void 0!==t&&(this.unbind("EnterFrame",t.handler),delete this._collisionData[n])}return this},resetHitChecks:function(){var t,e=arguments,i=0;if(0===e.length)for(t in this._collisionData)this._collisionData[t].occurring=!1;for(1===e.length&&(e=e[0].split(/\s*,\s*/));i<e.length;++i){var n=e[i];t=this._collisionData[n],void 0!==t&&(t.occurring=!1)}return this},_SAT:function(t,e){for(var i,n,s,r,o,a,h,c,u,l,d=t.points,_=e.points,f=0,p=d.length,g=_.length,m={x:0,y:0},y=null,v=null,x=null;p>f;f++){for(u=d[f==p-1?0:f+1],l=d[f],m.x=-(u[1]-l[1]),m.y=u[0]-l[0],n=Math.sqrt(m.x*m.x+m.y*m.y),m.x/=n,m.y/=n,s=r=1/0,o=a=-(1/0),i=0;p>i;++i)c=d[i][0]*m.x+d[i][1]*m.y,c>o&&(o=c),s>c&&(s=c);for(i=0;g>i;++i)c=_[i][0]*m.x+_[i][1]*m.y,c>a&&(a=c),r>c&&(r=c);if(r>s?(h=r-o,m.x=-m.x,m.y=-m.y):h=s-a,h>=0)return!1;(null===y||h>y)&&(y=h,x={x:m.x,y:m.y})}for(f=0;g>f;f++){for(u=_[f==g-1?0:f+1],l=_[f],m.x=-(u[1]-l[1]),m.y=u[0]-l[0],n=Math.sqrt(m.x*m.x+m.y*m.y),m.x/=n,m.y/=n,s=r=1/0,o=a=-(1/0),i=0;p>i;++i)c=d[i][0]*m.x+d[i][1]*m.y,c>o&&(o=c),s>c&&(s=c);for(i=0;g>i;++i)c=_[i][0]*m.x+_[i][1]*m.y,c>a&&(a=c),r>c&&(r=c);if(r>s?(h=r-o,m.x=-m.x,m.y=-m.y):h=s-a,h>=0)return!1;(null===y||h>y)&&(y=h),(h>v||null===v)&&(v=h,x={x:m.x,y:m.y})}return{overlap:v,normal:x}}})},{"./core.js":10}],8:[function(t,e,i){var n=t("./core.js"),s=window.document;n.extend({assignColor:function(){function t(t){return t._red=t._blue=t._green=0,t}function e(t){var e=t.toString(16);return 1==e.length&&(e="0"+e),e}function i(t,i,n){return"#"+e(t)+e(i)+e(n)}function n(e,i){var n;if(7===e.length)n=2;else{if(4!==e.length)return t(i);n=1}return i._red=parseInt(e.substr(1,n),16),i._green=parseInt(e.substr(1+n,n),16),i._blue=parseInt(e.substr(1+2*n,n),16),i}function r(e,i){var n=l.exec(e);return null===n||4!=n.length&&5!=n.length?t(i):(i._red=Math.round(parseFloat(n[1])),i._green=Math.round(parseFloat(n[2])),i._blue=Math.round(parseFloat(n[3])),n[4]&&(i._strength=parseFloat(n[4])),i)}function o(t,e){if("undefined"==typeof u[t]){c===!1&&(window.document.body.appendChild(h),c=!0),h.style.color=t;var s=window.getComputedStyle(h).color;r(s,e),u[t]=i(e._red,e._green,e._blue)}else n(u[t],e);return e}function a(t){return"rgba("+t._red+", "+t._green+", "+t._blue+", "+t._strength+")"}var h=s.createElement("div");h.style.display="none";var c=!1,u={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#00ff00",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"},l=/rgba?\s*\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,?\s*([0-9.]+)?\)/;return function(t,e){e=e||{},t=t.trim().toLowerCase();var i=null;i="#"===t[0]?n(t,e):"r"===t[0]&&"g"===t[1]&&"b"===t[2]?r(t,e):o(t,e),e._strength=e._strength||1,e._color=a(e)}}()}),n.c("Color",{_red:0,_green:0,_blue:0,_strength:1,_color:"",ready:!0,init:function(){this.bind("Draw",this._drawColor),this.trigger("Invalidate")},remove:function(){this.unbind("Draw",this._drawColor),this.has("DOM")&&(this._element.style.backgroundColor="transparent"),this.trigger("Invalidate")},_drawColor:function(t){this._color&&("DOM"===t.type?(t.style.backgroundColor=this._color,
t.style.lineHeight=0):"canvas"===t.type&&(t.ctx.fillStyle=this._color,t.ctx.fillRect(t.pos._x,t.pos._y,t.pos._w,t.pos._h)))},color:function(t){return 0===arguments.length?this._color:(arguments.length>=3?(this._red=arguments[0],this._green=arguments[1],this._blue=arguments[2],"number"==typeof arguments[3]&&(this._strength=arguments[3])):(n.assignColor(t,this),"number"==typeof arguments[1]&&(this._strength=arguments[1])),this._color="rgba("+this._red+", "+this._green+", "+this._blue+", "+this._strength+")",this.trigger("Invalidate"),this)}})},{"./core.js":10}],9:[function(t,e,i){var n=t("./core.js"),s=window.document;n.extend({over:null,mouseObjs:0,mousePos:{},lastEvent:null,keydown:{},selected:!1,detectBlur:function(t){var e=t.clientX>n.stage.x&&t.clientX<n.stage.x+n.viewport.width&&t.clientY>n.stage.y&&t.clientY<n.stage.y+n.viewport.height;!n.selected&&e&&n.trigger("CraftyFocus"),n.selected&&!e&&n.trigger("CraftyBlur"),n.selected=e},resetKeyDown:function(){for(var t in n.keys)n.keydown[n.keys[t]]&&this.trigger("KeyUp",{key:n.keys[t]});n.keydown={}},mouseDispatch:function(t){if(n.mouseObjs){n.lastEvent=t;var e,i,s,r,o,a=-1,h=0,c=n.DOM.translate(t.clientX,t.clientY),u={},l=t.target?t.target:t.srcElement,d=t.type;if("undefined"==typeof t.which?t.mouseButton=t.button<2?n.mouseButtons.LEFT:4==t.button?n.mouseButtons.MIDDLE:n.mouseButtons.RIGHT:t.mouseButton=t.which<2?n.mouseButtons.LEFT:2==t.which?n.mouseButtons.MIDDLE:n.mouseButtons.RIGHT,t.realX=r=n.mousePos.x=c.x,t.realY=o=n.mousePos.y=c.y,"CANVAS"!=l.nodeName){for(;"string"!=typeof l.id&&-1==l.id.indexOf("ent");)l=l.parentNode;ent=n(parseInt(l.id.replace("ent",""),10)),ent.has("Mouse")&&ent.isAt(r,o)&&(e=ent)}if(!e)for(i=n.map.search({_x:r,_y:o,_w:1,_h:1},!1),s=i.length;s>h;++h)if(i[h].__c.Mouse&&i[h]._visible){var _=i[h],f=!1;if(!u[_[0]]&&(u[_[0]]=!0,_.mapArea?_.mapArea.containsPoint(r,o)&&(f=!0):_.isAt(r,o)&&(f=!0),f&&(_._z>=a||-1===a))){if(_._z===a&&_[0]<e[0])continue;a=_._z,e=_}}e?"mousedown"===d?e.trigger("MouseDown",t):"mouseup"===d?e.trigger("MouseUp",t):"dblclick"==d?e.trigger("DoubleClick",t):"click"==d?e.trigger("Click",t):"mousemove"===d?(e.trigger("MouseMove",t),this.over!==e&&(this.over&&(this.over.trigger("MouseOut",t),this.over=null),this.over=e,e.trigger("MouseOver",t))):e.trigger(d,t):("mousemove"===d&&this.over&&(this.over.trigger("MouseOut",t),this.over=null),"mousedown"===d?n.viewport.mouselook("start",t):"mousemove"===d?n.viewport.mouselook("drag",t):"mouseup"==d&&n.viewport.mouselook("stop")),"mousemove"===d&&(this.lastEvent=t)}},touchDispatch:function(t){var e,i=n.lastEvent;"touchstart"===t.type?e="mousedown":"touchmove"===t.type?e="mousemove":"touchend"===t.type?e="mouseup":"touchcancel"===t.type?e="mouseup":"touchleave"===t.type&&(e="mouseup"),t.touches&&t.touches.length?first=t.touches[0]:t.changedTouches&&t.changedTouches.length&&(first=t.changedTouches[0]);var r=s.createEvent("MouseEvent");r.initMouseEvent(e,!0,!0,window,1,first.screenX,first.screenY,first.clientX,first.clientY,!1,!1,!1,!1,0,t.relatedTarget),first.target.dispatchEvent(r),null!==i&&"mousedown"==i.type&&"mouseup"==e&&(e="click",r=s.createEvent("MouseEvent"),r.initMouseEvent(e,!0,!0,window,1,first.screenX,first.screenY,first.clientX,first.clientY,!1,!1,!1,!1,0,t.relatedTarget),first.target.dispatchEvent(r)),t.target&&"INPUT"!==t.target.nodeName&&"TEXTAREA"!==t.target.nodeName&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},keyboardDispatch:function(t){for(var e=t,i={},s="char charCode keyCode type shiftKey ctrlKey metaKey timestamp".split(" "),r=s.length;r;){var o=s[--r];i[o]=e[o]}return i.which=null!==e.charCode?e.charCode:e.keyCode,i.key=e.keyCode||e.which,i.originalEvent=e,t=i,"keydown"===t.type?n.keydown[t.key]!==!0&&(n.keydown[t.key]=!0,n.trigger("KeyDown",t)):"keyup"===t.type&&(delete n.keydown[t.key],n.trigger("KeyUp",t)),n.selected&&!(8==t.key||t.key>=112&&t.key<=135)?(t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.target&&"INPUT"!==t.target.nodeName&&"TEXTAREA"!==t.target.nodeName&&(t.preventDefault?t.preventDefault():t.returnValue=!1),!1):void 0}}),n.bind("Load",function(){n.addEvent(this,"keydown",n.keyboardDispatch),n.addEvent(this,"keyup",n.keyboardDispatch),n.addEvent(this,n.stage.elem,"mousedown",n.mouseDispatch),n.addEvent(this,n.stage.elem,"mouseup",n.mouseDispatch),n.addEvent(this,s.body,"mouseup",n.detectBlur),n.addEvent(this,window,"blur",n.resetKeyDown),n.addEvent(this,n.stage.elem,"mousemove",n.mouseDispatch),n.addEvent(this,n.stage.elem,"click",n.mouseDispatch),n.addEvent(this,n.stage.elem,"dblclick",n.mouseDispatch),n.addEvent(this,n.stage.elem,"touchstart",n.touchDispatch),n.addEvent(this,n.stage.elem,"touchmove",n.touchDispatch),n.addEvent(this,n.stage.elem,"touchend",n.touchDispatch),n.addEvent(this,n.stage.elem,"touchcancel",n.touchDispatch),n.addEvent(this,n.stage.elem,"touchleave",n.touchDispatch)}),n.bind("CraftyStop",function(){n.removeEvent(this,"keydown",n.keyboardDispatch),n.removeEvent(this,"keyup",n.keyboardDispatch),n.stage&&(n.removeEvent(this,n.stage.elem,"mousedown",n.mouseDispatch),n.removeEvent(this,n.stage.elem,"mouseup",n.mouseDispatch),n.removeEvent(this,n.stage.elem,"mousemove",n.mouseDispatch),n.removeEvent(this,n.stage.elem,"click",n.mouseDispatch),n.removeEvent(this,n.stage.elem,"dblclick",n.mouseDispatch),n.removeEvent(this,n.stage.elem,"touchstart",n.touchDispatch),n.removeEvent(this,n.stage.elem,"touchmove",n.touchDispatch),n.removeEvent(this,n.stage.elem,"touchend",n.touchDispatch),n.removeEvent(this,n.stage.elem,"touchcancel",n.touchDispatch),n.removeEvent(this,n.stage.elem,"touchleave",n.touchDispatch)),n.removeEvent(this,s.body,"mouseup",n.detectBlur),n.removeEvent(this,window,"blur",n.resetKeyDown)}),n.c("Mouse",{init:function(){n.mouseObjs++,this.bind("Remove",function(){n.mouseObjs--})},areaMap:function(t){if(arguments.length>1){var e=Array.prototype.slice.call(arguments,0);t=new n.polygon(e)}return t.shift(this._x,this._y),this.mapArea=t,this.attach(this.mapArea),this}}),n.c("Draggable",{_origMouseDOMPos:null,_oldX:null,_oldY:null,_dragging:!1,_dir:null,init:function(){this.requires("Mouse"),this.enableDrag()},_ondrag:function(t){var e=n.DOM.translate(t.clientX,t.clientY);if(0===e.x||0===e.y)return!1;if(this._dir){var i=(e.x-this._origMouseDOMPos.x)*this._dir.x+(e.y-this._origMouseDOMPos.y)*this._dir.y;this.x=this._oldX+i*this._dir.x,this.y=this._oldY+i*this._dir.y}else this.x=this._oldX+(e.x-this._origMouseDOMPos.x),this.y=this._oldY+(e.y-this._origMouseDOMPos.y);this.trigger("Dragging",t)},_ondown:function(t){t.mouseButton===n.mouseButtons.LEFT&&this._startDrag(t)},_onup:function(t){t.mouseButton===n.mouseButtons.LEFT&&this._dragging===!0&&(n.removeEvent(this,n.stage.elem,"mousemove",this._ondrag),n.removeEvent(this,n.stage.elem,"mouseup",this._onup),this._dragging=!1,this.trigger("StopDrag",t))},dragDirection:function(t){if("undefined"==typeof t)this._dir=null;else if(""+parseInt(t,10)==t)this._dir={x:Math.cos(t/180*Math.PI),y:Math.sin(t/180*Math.PI)};else{var e=Math.sqrt(t.x*t.x+t.y*t.y);this._dir={x:t.x/e,y:t.y/e}}},_startDrag:function(t){this._origMouseDOMPos=n.DOM.translate(t.clientX,t.clientY),this._oldX=this._x,this._oldY=this._y,this._dragging=!0,n.addEvent(this,n.stage.elem,"mousemove",this._ondrag),n.addEvent(this,n.stage.elem,"mouseup",this._onup),this.trigger("StartDrag",t)},stopDrag:function(){return n.removeEvent(this,n.stage.elem,"mousemove",this._ondrag),n.removeEvent(this,n.stage.elem,"mouseup",this._onup),this._dragging=!1,this.trigger("StopDrag"),this},startDrag:function(){return this._dragging||this._startDrag(n.lastEvent),this},enableDrag:function(){return this.bind("MouseDown",this._ondown),n.addEvent(this,n.stage.elem,"mouseup",this._onup),this},disableDrag:function(){return this.unbind("MouseDown",this._ondown),this._dragging&&this.stopDrag(),this}}),n.c("Keyboard",{isDown:function(t){return"string"==typeof t&&(t=n.keys[t]),!!n.keydown[t]}}),n.c("Multiway",{_speed:3,_keydown:function(t){this._keys[t.key]&&(this._movement.x=Math.round(1e3*(this._movement.x+this._keys[t.key].x))/1e3,this._movement.y=Math.round(1e3*(this._movement.y+this._keys[t.key].y))/1e3,this.trigger("NewDirection",this._movement))},_keyup:function(t){this._keys[t.key]&&(this._movement.x=Math.round(1e3*(this._movement.x-this._keys[t.key].x))/1e3,this._movement.y=Math.round(1e3*(this._movement.y-this._keys[t.key].y))/1e3,this.trigger("NewDirection",this._movement))},_enterframe:function(){this.disableControls||(0!==this._movement.x&&(this.x+=this._movement.x,this.trigger("Moved",{x:this.x-this._movement.x,y:this.y})),0!==this._movement.y&&(this.y+=this._movement.y,this.trigger("Moved",{x:this.x,y:this.y-this._movement.y})))},_initializeControl:function(){return this.unbind("KeyDown",this._keydown).unbind("KeyUp",this._keyup).unbind("EnterFrame",this._enterframe).bind("KeyDown",this._keydown).bind("KeyUp",this._keyup).bind("EnterFrame",this._enterframe)},multiway:function(t,e){this._keyDirection={},this._keys={},this._movement={x:0,y:0},this._speed={x:3,y:3},e?void 0!==t.x&&void 0!==t.y?(this._speed.x=t.x,this._speed.y=t.y):(this._speed.x=t,this._speed.y=t):e=t,this._keyDirection=e,this.speed(this._speed),this._initializeControl();for(var i in e)n.keydown[n.keys[i]]&&this.trigger("KeyDown",{key:n.keys[i]});return this},enableControl:function(){return this.disableControls=!1,this},disableControl:function(){return this.disableControls=!0,this},speed:function(t){for(var e in this._keyDirection){var i=n.keys[e]||e;this._keys[i]={x:Math.round(1e3*Math.cos(this._keyDirection[e]*(Math.PI/180))*t.x)/1e3,y:Math.round(1e3*Math.sin(this._keyDirection[e]*(Math.PI/180))*t.y)/1e3}}return this}}),n.c("Fourway",{init:function(){this.requires("Multiway")},fourway:function(t){return this.multiway(t,{UP_ARROW:-90,DOWN_ARROW:90,RIGHT_ARROW:0,LEFT_ARROW:180,W:-90,S:90,D:0,A:180,Z:-90,Q:180}),this}}),n.c("Twoway",{_speed:3,_up:!1,init:function(){this.requires("Fourway, Keyboard, Gravity")},twoway:function(t,e){return this.multiway(t,{RIGHT_ARROW:0,LEFT_ARROW:180,D:0,A:180,Q:180}),t&&(this._speed=t),arguments.length<2?this._jumpSpeed=2*this._speed:this._jumpSpeed=e,this.bind("EnterFrame",function(){this.disableControls||this._up&&(this.y-=this._jumpSpeed,this._falling=!0,this.trigger("Moved",{x:this._x,y:this._y+this._jumpSpeed}))}).bind("KeyDown",function(t){this._falling||t.key!==n.keys.UP_ARROW&&t.key!==n.keys.W&&t.key!==n.keys.Z||(this._up=!0)}),this}})},{"./core.js":10}],10:[function(t,e,i){function n(){var t=r++;return t in h?n():t}function s(t){if(null===t||"object"!=typeof t)return t;var e=t.constructor();for(var i in t)e[i]=s(t[i]);return e}var r,o,a,h,c,u,l,d,_,f=t("./version"),p=function(t){return new p.fn.init(t)};a={},l=Array.prototype.slice,d=/\s*,\s*/,_=/\s+/;var g=function(){r=1,o=0,h={},c={},u=[]};g(),p.fn=p.prototype={init:function(t){if("string"!=typeof t)return t||(t=0,t in h||(h[t]=this)),t in h?(this[0]=t,this.length=1,this.__c||(this.__c={}),h[t]||(h[t]=this),h[t]):(this.length=0,this);var e,i,n,s,r,o,c,u=0,l=!1,f=!1;if("*"===t){o=0;for(e in h)this[o]=+e,o++;return this.length=o,1===o?h[this[0]]:this}-1!==t.indexOf(",")?(f=!0,n=d):-1!==t.indexOf(" ")&&(l=!0,n=_);for(e in h)if(h.hasOwnProperty(e))if(i=h[e],l||f){for(s=t.split(n),o=0,c=s.length,r=0;c>o;o++)i.__c[s[o]]&&r++;(l&&r===c||f&&r>0)&&(this[u++]=+e)}else i.__c[t]&&(this[u++]=+e);if(u>0&&!l&&!f&&this.extend(a[t]),s&&l)for(o=0;c>o;o++)this.extend(a[s[o]]);return this.length=u,1===u?h[this[u-1]]:this},setName:function(t){var e=String(t);return this._entityName=e,this.trigger("NewEntityName",e),this},addComponent:function(t){var e=[],i=0;if(arguments.length>1)for(var n=0;n<arguments.length;n++)e.push(arguments[n]);else-1!==t.indexOf(",")?e=t.split(d):e.push(t);for(;i<e.length;i++)this.__c[e[i]]!==!0&&(this.__c[e[i]]=!0,this.extend(a[e[i]]),a[e[i]]&&"init"in a[e[i]]&&a[e[i]].init.call(this));return this.trigger("NewComponent",e),this},toggleComponent:function(t){var e,i,n=0;if(arguments.length>1)for(e=arguments.length;e>n;n++)this.has(arguments[n])?this.removeComponent(arguments[n]):this.addComponent(arguments[n]);else if(-1!==t.indexOf(","))for(i=t.split(d),e=i.length;e>n;n++)this.has(i[n])?this.removeComponent(i[n]):this.addComponent(i[n]);else this.has(t)?this.removeComponent(t):this.addComponent(t);return this},requires:function(t){return this.addComponent(t)},removeComponent:function(t,e){var i=a[t];if(this.trigger("RemoveComponent",t),i&&"remove"in i&&i.remove.call(this,!1),e===!1&&i)for(var n in i)delete this[n];return delete this.__c[t],this},getId:function(){return this[0]},has:function(t){return!!this.__c[t]},attr:function(t,e,i,n){return 1===arguments.length&&"string"==typeof arguments[0]?this._attr_get(t):this._attr_set(t,e,i,n)},_attr_get:function(t,e){var i,n,s;return("undefined"==typeof e||null===e)&&(e=this),t.indexOf(".")>-1?(n=t.split("."),i=n.shift(),s=n.join("."),this._attr_get(n.join("."),e[i])):e[t]},_attr_set:function(){var t,e,i;return"string"==typeof arguments[0]?(t=this._set_create_object(arguments[0],arguments[1]),e=!!arguments[2],i=arguments[3]||arguments[0].indexOf(".")>-1):(t=arguments[0],e=!!arguments[1],i=!!arguments[2]),e||this.trigger("Change",t),i?this._recursive_extend(t,this):this.extend.call(this,t),this},_set_create_object:function(t,e){var i,n,s,r={};return t.indexOf(".")>-1?(i=t.split("."),n=i.shift(),s=i.join("."),r[n]=this._set_create_object(s,e)):r[t]=e,r},_recursive_extend:function(t,e){var i;for(i in t)"Object"===t[i].constructor.name?e[i]=this._recursive_extend(t[i],e[i]):e[i]=t[i];return e},toArray:function(){return l.call(this,0)},timeout:function(t,e){return this.each(function(){var i=this;setTimeout(function(){t.call(i)},e)}),this},bind:function(t,e){var i,n=c[t]||(c[t]={});return 1===this.length?(i=n[this[0]],i||(i=n[this[0]]=[],i.depth=0),i.push(e),this):(this.each(function(){i=n[this[0]],i||(i=n[this[0]]=[],i.depth=0),i.push(e)}),this)},uniqueBind:function(t,e){this.unbind(t,e),this.bind(t,e)},one:function(t,e){var i=this,n=function(s){e.call(i,s),i.unbind(t,n)};return i.bind(t,n)},unbind:function(t,e){return this.each(function(){var i,n,s=c[t]||(c[t]={}),r=0;if(!s||!s[this[0]])return this;if(i=s[this[0]].length,!e)return delete s[this[0]],this;for(;i>r;r++)n=s[this[0]],n[r]==e&&delete n[r]}),this},trigger:function(t,e){var i=c[t]||(c[t]={});if(1===this.length){if(i&&i[this[0]]){var n,s=i[this[0]],r=s.length;for(s.depth++,n=0;r>n;n++)"undefined"==typeof s[n]&&s.depth<=1?(s.splice(n,1),n--,r--):s[n].call(this,e);s.depth--}return this}return this.each(function(){if(c[t]&&c[t][this[0]]){var i,n=c[t][this[0]],s=n.length;for(n.depth++,i=0;s>i;i++)"undefined"==typeof n[i]&&n.depth<=1?(n.splice(i,1),i--,s--):n[i].call(this,e);n.depth--}}),this},each:function(t){for(var e=0,i=this.length;i>e;e++)h[this[e]]&&t.call(h[this[e]],e);return this},get:function(t){var e=this.length;if("undefined"!=typeof t)return t>=e||0>t+e?void 0:t>=0?h[this[t]]:h[this[t+e]];for(var i=0,n=[];e>i;i++)h[this[i]]&&n.push(h[this[i]]);return n},clone:function(){var t,e,i=this.__c,n=p.e();for(t in i)n.addComponent(t);for(e in this)"0"!=e&&"_global"!=e&&"_changed"!=e&&"function"!=typeof this[e]&&"object"!=typeof this[e]&&(n[e]=this[e]);return n},setter:function(t,e){return p.support.setter?this.__defineSetter__(t,e):p.support.defineProperty&&Object.defineProperty(this,t,{set:e,configurable:!0}),this},destroy:function(){this.each(function(){var t;this.trigger("Remove");for(var e in this.__c)t=a[e],t&&"remove"in t&&t.remove.call(this,!0);for(var i in c)this.unbind(i);delete h[this[0]]})}},p.fn.init.prototype=p.fn,p.extend=p.fn.extend=function(t){var e,i=this;if(!t)return i;for(e in t)i!==t[e]&&(i[e]=t[e]);return i},p.extend({init:function(t,e,i){return p.viewport.init(t,e,i),this.trigger("Load"),this.timer.init(),this},getVersion:function(){return f},stop:function(t){if(this.timer.stop(),t){if(p.audio.remove(),p.stage&&p.stage.elem.parentNode){var e=document.createElement("div");e.id=p.stage.elem.id,p.stage.elem.parentNode.replaceChild(e,p.stage.elem)}g()}return p.trigger("CraftyStop"),this},pause:function(t){return(1===arguments.length?t:!this._paused)?(this.trigger("Pause"),this._paused=!0,setTimeout(function(){p.timer.stop()},0),p.keydown={}):(this.trigger("Unpause"),this._paused=!1,setTimeout(function(){p.timer.init()},0)),this},isPaused:function(){return this._paused},timer:function(){var t,e,i,n="fixed",s=5,r=40,a=0,h=0,c=50,u=1e3/c;return{init:function(){"undefined"==typeof i&&(i=(new Date).getTime()-u);var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||null;n?(t=function(){p.timer.step(),e=n(t)})():t=setInterval(function(){p.timer.step()},1e3/c)},stop:function(){p.trigger("CraftyStopTimer"),"number"==typeof t&&clearInterval(t);var i=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||null;i&&i(e),t=null},steptype:function(t,e){if("variable"===t||"semifixed"===t)n=t,e&&(r=e);else{if("fixed"!==t)throw"Invalid step type specified";n="fixed",e&&(s=e)}},step:function(){var t,e,c,l=0;if(currentTime=(new Date).getTime(),a>0&&p.trigger("MeasureWaitTime",currentTime-a),i+h>=currentTime)return void(a=currentTime);var d=currentTime-(i+h);d>20*u&&(h+=d-u,d=u),"fixed"===n?(l=Math.ceil(d/u),l=Math.min(l,s),e=u):"variable"===n?(l=1,e=d,e=Math.min(e,r)):"semifixed"===n&&(l=Math.ceil(d/r),e=d/l);for(var _=0;l>_;_++){c=currentTime;var f={frame:o++,dt:e,gameTime:i};p.trigger("EnterFrame",f),p.trigger("ExitFrame",f),i+=e,currentTime=(new Date).getTime(),p.trigger("MeasureFrameTime",currentTime-c)}l>0&&(t=currentTime,p.trigger("PreRender"),p.trigger("RenderScene"),p.trigger("PostRender"),currentTime=(new Date).getTime(),p.trigger("MeasureRenderTime",currentTime-t)),a=currentTime},FPS:function(t){return"undefined"==typeof t?c:(c=t,void(u=1e3/c))},simulateFrames:function(t,e){for("undefined"==typeof e&&(e=u);t-->0;){var i={frame:o++,dt:e};p.trigger("EnterFrame",i),p.trigger("ExitFrame",i)}p.trigger("PreRender"),p.trigger("RenderScene"),p.trigger("PostRender")}}}(),e:function(){var t=n();return h[t]=null,h[t]=p(t),arguments.length>0&&h[t].addComponent.apply(h[t],arguments),h[t].setName("Entity #"+t),h[t].addComponent("obj"),p.trigger("NewEntity",{id:t}),h[t]},c:function(t,e){a[t]=e},trigger:function(t,e){var i,n,s,r,o,a=c[t]||(c[t]={});for(i in a)if(a.hasOwnProperty(i)&&(r=a[i],r&&0!==r.length)){if(h[i])o=p(+i);else{if("global"!==i)continue;o=p}for(r.depth++,s=r.length,n=0;s>n;n++)"undefined"==typeof r[n]&&r.depth<=1?(r.splice(n,1),n--,s--):r[n].call(o,e);r.depth--}},bind:function(t,e){var i=c[t]||(c[t]={});return i.global||(i.global=[],i.global.depth=0),i.global.push(e),e},uniqueBind:function(t,e){return this.unbind(t,e),this.bind(t,e)},one:function(t,e){var i=this,n=function(s){e.call(i,s),i.unbind(t,n)};return i.bind(t,n)},unbind:function(t,e){var i,n,s,r,o=c[t];if(void 0===o||void 0===o.global||0===o.global.length)return!1;if(1===arguments.length)return delete o.global,!0;for(s=o.global,r=!1,i=0,n=s.length;n>i;i++)s[i]===e&&(r=!0,delete s[i]);return r},frame:function(){return o},components:function(){return a},isComp:function(t){return t in a},debug:function(t){return"handlers"===t?c:h},settings:function(){var t={},e={};return{register:function(t,i){e[t]=i},modify:function(i,n){e[i]&&(e[i].call(t[i],n),t[i]=n)},get:function(e){return t[e]}}}(),clone:s}),"function"==typeof define&&define("crafty",[],function(){return p}),e.exports=p},{"./version":30}],11:[function(t,e,i){var n=t("./core");t("./2D"),t("./animation"),t("./canvas"),t("./collision"),t("./color"),t("./controls"),t("./DebugLayer"),t("./device"),t("./diamondiso"),t("./DOM"),t("./drawing"),t("./extensions"),t("./HashMap"),t("./html"),t("./isometric"),t("./keycodes"),t("./loader"),t("./math"),t("./model"),t("./particles"),t("./scenes"),t("./sound"),t("./sprite-animation"),t("./sprite"),t("./storage"),t("./text"),t("./time"),t("./version"),t("./viewport"),window&&(window.Crafty=n),e.exports=n},{"./2D":1,"./DOM":2,"./DebugLayer":3,"./HashMap":4,"./animation":5,"./canvas":6,"./collision":7,"./color":8,"./controls":9,"./core":10,"./device":12,"./diamondiso":13,"./drawing":14,"./extensions":15,"./html":16,"./isometric":17,"./keycodes":18,"./loader":19,"./math":20,"./model":21,"./particles":22,"./scenes":23,"./sound":24,"./sprite":26,"./sprite-animation":25,"./storage":27,"./text":28,"./time":29,"./version":30,"./viewport":31}],12:[function(t,e,i){var n=t("./core.js");window.document;n.extend({device:{_deviceOrientationCallback:!1,_deviceMotionCallback:!1,_normalizeDeviceOrientation:function(t){var e;window.DeviceOrientationEvent?e={tiltLR:t.gamma,tiltFB:t.beta,dir:t.alpha,motUD:null}:window.OrientationEvent&&(e={tiltLR:90*t.x,tiltFB:-90*t.y,dir:null,motUD:t.z}),n.device._deviceOrientationCallback(e)},_normalizeDeviceMotion:function(t){var e=t.accelerationIncludingGravity,i=e.z>0?1:-1,s={acceleration:e,rawAcceleration:"["+Math.round(e.x)+", "+Math.round(e.y)+", "+Math.round(e.z)+"]",facingUp:i,tiltLR:Math.round(e.x/9.81*-90),tiltFB:Math.round((e.y+9.81)/9.81*90*i)};n.device._deviceMotionCallback(s)},deviceOrientation:function(t){this._deviceOrientationCallback=t,n.support.deviceorientation&&(window.DeviceOrientationEvent?n.addEvent(this,window,"deviceorientation",this._normalizeDeviceOrientation):window.OrientationEvent&&n.addEvent(this,window,"MozOrientation",this._normalizeDeviceOrientation))},deviceMotion:function(t){this._deviceMotionCallback=t,n.support.devicemotion&&window.DeviceMotionEvent&&n.addEvent(this,window,"devicemotion",this._normalizeDeviceMotion)}}})},{"./core.js":10}],13:[function(t,e,i){var n=t("./core.js");window.document;n.extend({diamondIso:{_tile:{width:0,height:0,r:0},_map:{width:0,height:0,x:0,y:0},_origin:{x:0,y:0},init:function(t,e,i,n){return this._tile.width=parseInt(t,10),this._tile.height=parseInt(e,10)||parseInt(t,10)/2,this._tile.r=this._tile.width/this._tile.height,this._map.width=parseInt(i,10),this._map.height=parseInt(n,10)||parseInt(i,10),this._origin.x=this._map.height*this._tile.width/2,this},place:function(t,e,i,n){var s=this.pos2px(e,i);n||(n=1);var r=0,o=0;void 0!==t.__margin&&(r=t.__margin[0],o=t.__margin[1]),t.x=s.left+r,t.y=s.top+o-t.h,t.z=s.top*n},centerAt:function(t,e){var i=this.pos2px(t,e);n.viewport.x=-i.left+n.viewport.width/2-this._tile.width,n.viewport.y=-i.top+n.viewport.height/2},area:function(t){t||(t=0);var e=n.viewport.rect(),i=e._x,s=e._y,r=e._w,o=e._h,a=t*this._tile.width,h=t*this._tile.height;i-=this._tile.width/2+a,s-=this._tile.height/2+h,r+=this._tile.width/2+a,o+=this._tile.height/2+h;var c=[];for(yl=s+o;s<yl;s+=this._tile.height/2)for(xl=i+r;i<xl;i+=this._tile.width/2){var u=this.px2pos(i,s);c.push([~~u.x,~~u.y])}return c},pos2px:function(t,e){return{left:(t-e)*this._tile.width/2+this._origin.x,top:(t+e)*this._tile.height/2}},px2pos:function(t,e){var i=(t-this._origin.x)/this._tile.r;return{x:(e+i)/this._tile.height,y:(e-i)/this._tile.height}},polygon:function(t){t.requires("Collision");var e=0,i=0;void 0!==t.__margin&&(e=t.__margin[0],i=t.__margin[1]);var s=[[e-0,t.h-i-this._tile.height/2],[e-this._tile.width/2,t.h-i-0],[e-this._tile.width,t.h-i-this._tile.height/2],[e-this._tile.width/2,t.h-i-this._tile.height]],r=new n.polygon(s);return r}}})},{"./core.js":10}],14:[function(t,e,i){var n=t("./core.js");window.document;n.c("Image",{_repeat:"repeat",ready:!1,init:function(){var t=function(t){if("canvas"===t.type){if(!this.ready||!this._pattern)return;var e=t.ctx;e.fillStyle=this._pattern,e.save(),e.translate(t.pos._x,t.pos._y),e.fillRect(0,0,this._w,this._h),e.restore()}else"DOM"===t.type&&this.__image&&(t.style.backgroundImage="url("+this.__image+")",t.style.backgroundRepeat=this._repeat)};this.bind("Draw",t).bind("RemoveComponent",function(e){"Image"===e&&this.unbind("Draw",t)})},image:function(t,e){if(this.__image=t,this._repeat=e||"no-repeat",this.img=n.asset(t),!this.img){this.img=new Image,n.asset(t,this.img),this.img.src=t;var i=this;return this.img.onload=function(){i.has("Canvas")&&(i._pattern=n.canvas.context.createPattern(i.img,i._repeat)),i.ready=!0,"no-repeat"===i._repeat&&(i.w=i.img.width,i.h=i.img.height),i.trigger("Invalidate")},this}return this.ready=!0,this.has("Canvas")&&(this._pattern=n.canvas.context.createPattern(this.img,this._repeat)),"no-repeat"===this._repeat&&(this.w=this.img.width,this.h=this.img.height),this.trigger("Invalidate"),this}}),n.DrawManager=function(){function t(t,e){return t._globalZ-e._globalZ}var e=[],i=[],s=[],r=!1,o={merge:function(t,e,i){return"undefined"==typeof i&&(i={}),i._h=Math.max(t._y+t._h,e._y+e._h),i._w=Math.max(t._x+t._w,e._x+e._w),i._x=Math.min(t._x,e._x),i._y=Math.min(t._y,e._y),i._w-=i._x,i._h-=i._y,i},clean:function(){var t,n,s;for(s=0,l=i.length;s<l;s++)n=i[s],t=n._mbr||n,"undefined"==typeof n.staleRect&&(n.staleRect={}),n.staleRect._x=t._x,n.staleRect._y=t._y,n.staleRect._w=t._w,n.staleRect._h=t._h,n._changed=!1;i.length=0,e.length=0},createDirty:function(t){var i=t._mbr||t;if(t.staleRect){if(o.overlap(t.staleRect,i))return o.merge(t.staleRect,i,t.staleRect),void e.push(t.staleRect);e.push(t.staleRect)}t.currentRect._x=i._x,t.currentRect._y=i._y,t.currentRect._w=i._w,t.currentRect._h=i._h,e.push(t.currentRect)},overlap:function(t,e){return t._x<e._x+e._w&&t._y<e._y+e._h&&t._x+t._w>e._x&&t._y+t._h>e._y}};return n.bind("InvalidateViewport",function(){r=!0}),n.bind("PostRender",function(){r=!1}),{total2D:n("2D").length,onScreen:function(t){return n.viewport._x+t._x+t._w>0&&n.viewport._y+t._y+t._h>0&&n.viewport._x+t._x<n.viewport.width&&n.viewport._y+t._y<n.viewport.height},mergeSet:function(t){for(var e=0;e<t.length-1;)o.overlap(t[e],t[e+1])?(o.merge(t[e],t[e+1],t[e]),t.splice(e+1,1),e>0&&e--):e++;return t},addCanvas:function(t){i.push(t)},addDom:function(t){s.push(t)},debug:function(){console.log(i,s)},drawAll:function(e){e=e||n.viewport.rect();var i,s=n.map.search(e),r=0,o=s.length,a=n.canvas.context;for(a.clearRect(e._x,e._y,e._w,e._h),s.sort(t);o>r;r++)i=s[r],i._visible&&i.__c.Canvas&&(i.draw(),i._changed=!1)},boundingRect:function(t){if(t&&t.length){var e,i,n=1,s=t.length,r=t[0];for(r=[r._x,r._y,r._x+r._w,r._y+r._h];s>n;)e=t[n],i=[e._x,e._y,e._x+e._w,e._y+e._h],i[0]<r[0]&&(r[0]=i[0]),i[1]<r[1]&&(r[1]=i[1]),i[2]>r[2]&&(r[2]=i[2]),i[3]>r[3]&&(r[3]=i[3]),n++;return i=r,r={_x:i[0],_y:i[1],_w:i[2]-i[0],_h:i[3]-i[1]}}},renderCanvas:function(){var s=i.length;if(s||r){var a,h,c,u,l,d=0,_=n.canvas.context,f=n.DrawManager;if(r){var p=n.viewport;_.setTransform(p._scale,0,0,p._scale,Math.round(p._x*p._scale),Math.round(p._y*p._scale))}if(s/f.total2D>.6||r)return f.drawAll(),void o.clean();for(d=0;s>d;d++)o.createDirty(i[d]);e=f.mergeSet(e),s=e.length;var g=[],m=[];for(d=0;s>d;++d)if(a=e[d],g.length=0,m.length=0,a){for(a._w=a._x+a._w,a._h=a._y+a._h,a._x=a._x>0?0|a._x:(0|a._x)-1,a._y=a._y>0?0|a._y:(0|a._y)-1,a._w-=a._x,a._h-=a._y,a._w=a._w===(0|a._w)?a._w:(0|a._w)+1,a._h=a._h===(0|a._h)?a._h:(0|a._h)+1,h=n.map.search(a,!1),_.clearRect(a._x,a._y,a._w,a._h),_.save(),_.beginPath(),_.rect(a._x,a._y,a._w,a._h),_.clip(),c=0,u=h.length;u>c;++c)l=h[c],!g[l[0]]&&l._visible&&l.__c.Canvas&&(g[l[0]]=!0,m.push(l));for(m.sort(t),c=0,u=m.length;u>c;++c){l=m[c];var y=l._mbr||l;o.overlap(y,a)&&l.draw(),l._changed=!1}_.closePath(),_.restore()}if(n.DrawManager.debugDirty===!0)for(_.strokeStyle="red",d=0,s=e.length;s>d;++d)a=e[d],_.strokeRect(a._x,a._y,a._w,a._h);o.clean()}},renderDOM:function(){if(r){var t=n.stage.inner.style,e=n.viewport;t.transform=t[n.support.prefix+"Transform"]="scale("+e._scale+", "+e._scale+")",t.left=Math.round(e._x*e._scale)+"px",t.top=Math.round(e._y*e._scale)+"px",t.zIndex=10}if(s.length){for(var i=0,o=s.length;o>i;++i)s[i].draw()._changed=!1;s.length=0}}}}(),n.extend({_pixelartEnabled:!1,pixelart:function(t){n._pixelartEnabled=t,n.trigger("PixelartSet",t)}})},{"./core.js":10}],15:[function(t,e,i){var n=t("./core.js"),s=window.document;!function(){var t=n.support={},e=navigator.userAgent.toLowerCase(),i=/(webkit)[ \/]([\w.]+)/.exec(e)||/(o)pera(?:.*version)?[ \/]([\w.]+)/.exec(e)||/(ms)ie ([\w.]+)/.exec(e)||/(moz)illa(?:.*? rv:([\w.]+))?/.exec(e)||[],r=/iPad|iPod|iPhone|Android|webOS|IEMobile/i.exec(e);if(r&&(n.mobile=r[0]),t.defineProperty=function(){if(!("defineProperty"in Object))return!1;try{Object.defineProperty({},"x",{})}catch(t){return!1}return!0}(),t.audio="Audio"in window,t.prefix=i[1]||i[0],"moz"===t.prefix&&(t.prefix="Moz"),"o"===t.prefix&&(t.prefix="O"),i[2]&&(t.versionName=i[2],t.version=+i[2].split(".")[0]),t.canvas="getContext"in s.createElement("canvas"),t.canvas){var o;try{o=s.createElement("canvas").getContext("experimental-webgl"),o.viewportWidth=t.canvas.width,o.viewportHeight=t.canvas.height}catch(a){}t.webgl=!!o}else t.webgl=!1;t.css3dtransform="undefined"!=typeof s.createElement("div").style.Perspective||"undefined"!=typeof s.createElement("div").style[t.prefix+"Perspective"],t.deviceorientation="undefined"!=typeof window.DeviceOrientationEvent||"undefined"!=typeof window.OrientationEvent,t.devicemotion="undefined"!=typeof window.DeviceMotionEvent}(),n.extend({_events:{},addEvent:function(t,e,i,n){3===arguments.length&&(n=i,i=e,e=window.document);var s=function(e){e=e||window.event,"function"==typeof n&&n.call(t,e)},r=t[0]||"";this._events[r+e+i+n]||(this._events[r+e+i+n]=s,e.attachEvent?e.attachEvent("on"+i,s):e.addEventListener(i,s,!1))},removeEvent:function(t,e,i,n){3===arguments.length&&(n=i,i=e,e=window.document);var s=t[0]||"",r=this._events[s+e+i+n];r&&(e.detachEvent?e.detachEvent("on"+i,r):e.removeEventListener(i,r,!1),delete this._events[s+e+i+n])},background:function(t){n.stage.elem.style.background=t}})},{"./core.js":10}],16:[function(t,e,i){var n=t("./core.js");window.document;n.c("HTML",{inner:"",init:function(){this.requires("2D, DOM")},replace:function(t){return this.inner=t,this._element.innerHTML=t,this},append:function(t){return this.inner+=t,this._element.innerHTML+=t,this},prepend:function(t){return this.inner=t+this.inner,this._element.innerHTML=t+this.inner,this}})},{"./core.js":10}],17:[function(t,e,i){var n=t("./core.js");window.document;n.extend({isometric:{_tile:{width:0,height:0},_elements:{},_pos:{x:0,y:0},_z:0,size:function(t,e){return this._tile.width=t,this._tile.height=e>0?e:t/2,this},place:function(t,e,i,s){var r=this.pos2px(t,e);return r.top-=i*(this._tile.height/2),s.attr({x:r.left+n.viewport._x,y:r.top+n.viewport._y}).z+=i,this},pos2px:function(t,e){return{left:t*this._tile.width+(1&e)*(this._tile.width/2),top:e*this._tile.height/2}},px2pos:function(t,e){return{x:-Math.ceil(-t/this._tile.width-.5*(1&e)),y:e/this._tile.height*2}},centerAt:function(t,e){if("number"==typeof t&&"number"==typeof e){var i=this.pos2px(t,e);return n.viewport._x=-i.left+n.viewport.width/2-this._tile.width/2,n.viewport._y=-i.top+n.viewport.height/2-this._tile.height/2,this}return{top:-n.viewport._y+n.viewport.height/2-this._tile.height/2,left:-n.viewport._x+n.viewport.width/2-this._tile.width/2}},area:function(){var t=this.centerAt(),e=this.px2pos(-t.left+n.viewport.width/2,-t.top+n.viewport.height/2),i=this.px2pos(-t.left-n.viewport.width/2,-t.top-n.viewport.height/2);return{x:{start:e.x,end:i.x},y:{start:e.y,end:i.y}}}}})},{"./core.js":10}],18:[function(t,e,i){var n=t("./core.js");window.document;n.extend({keys:{BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,
DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,PULT_UP:29460,PULT_DOWN:29461,PULT_LEFT:4,PULT_RIGHT:5},mouseButtons:{LEFT:0,MIDDLE:1,RIGHT:2}})},{"./core.js":10}],19:[function(t,e,i){var n=t("./core.js");window.document;n.extend({assets:{},__paths:{audio:"",images:""},paths:function(t){return"undefined"==typeof t?this.__paths:(t.audio&&(this.__paths.audio=t.audio),void(t.images&&(this.__paths.images=t.images)))},asset:function(t,e){return 1===arguments.length?n.assets[t]:n.assets[t]?void 0:(n.assets[t]=e,this.trigger("NewAsset",{key:t,value:e}),e)},image_whitelist:["jpg","jpeg","gif","png","svg"],load:function(t,e,i,s){function r(){var t=this.src;this.removeEventListener&&this.removeEventListener("canplaythrough",r,!1),d++,i&&i({loaded:d,total:_,percent:d/_*100,src:t}),d===_&&e&&e()}function o(){var t=this.src;s&&s({loaded:d,total:_,percent:d/_*100,src:t}),d++,d===_&&e&&e()}t="string"==typeof t?JSON.parse(t):t;var a,h,c,u,l,d=0,_=(t.audio?Object.keys(t.audio).length:0)+(t.images?Object.keys(t.images).length:0)+(t.sprites?Object.keys(t.sprites).length:0),f=n.support.audio,p=n.paths(),g=function(t){return t.substr(t.lastIndexOf(".")+1,3).toLowerCase()},m=function(t,e){return-1===e.search("://")?"audio"==t?p.audio+e:p.images+e:e},y=function(t){return n.asset(t)||null},v=function(t){return n.audio.supports(g(t))},x=function(t){return-1!=n.image_whitelist.indexOf(g(t))},w=function(t,e){t.onload=r,"webkit"===n.support.prefix&&(t.src=""),t.src=e};for(u in t)for(l in t[u]){if(a=t[u][l],"audio"===u&&f){if("object"==typeof a){var b=[];for(var M in a)h=m(u,a[M]),!y(h)&&v(a[M])&&b.push(h);c=n.audio.add(l,b).obj}else"string"==typeof a&&v(a)&&(h=m(u,a),y(h)||(c=n.audio.add(l,h).obj));c&&c.addEventListener&&c.addEventListener("canplaythrough",r,!1)}else l="sprites"===u?l:a,h=m(u,l),x(l)&&(c=y(h),c||(c=new Image,"sprites"===u&&n.sprite(a.tile,a.tileh,h,a.map,a.paddingX,a.paddingY,a.paddingAroundBorder),n.asset(h,c)),w(c,h));c?c.onerror=o:--_}0===_&&e()},removeAssets:function(t){t="string"==typeof t?JSON.parse(t):t;var e,i,s,r,o=n.paths(),a=function(t,e){return-1===e.search("://")?"audio"==t?o.audio+e:o.images+e:e};for(s in t)for(r in t[s])if(e=t[s][r],"audio"===s)if("object"==typeof e)for(var h in e)i=a(s,e[h]),n.asset(i)&&n.audio.remove(r);else"string"==typeof e&&(i=a(s,e),n.asset(i)&&n.audio.remove(r));else if(r="sprites"===s?r:e,i=a(s,r),n.asset(i)){if("sprites"===s)for(var c in e.map)delete n.components()[c];delete n.assets[i]}}})},{"./core.js":10}],20:[function(t,e,i){var n=t("./core.js");window.document;n.math={abs:function(t){return 0>t?-t:t},amountOf:function(t,e,i){return i>e?(t-e)/(i-e):(t-i)/(e-i)},clamp:function(t,e,i){return t>i?i:e>t?e:t},degToRad:function(t){return t*Math.PI/180},distance:function(t,e,i,s){var r=n.math.squaredDistance(t,e,i,s);return Math.sqrt(parseFloat(r))},lerp:function(t,e,i){return t+(e-t)*i},negate:function(t){return Math.random()<t?-1:1},radToDeg:function(t){return 180*t/Math.PI},randomElementOfArray:function(t){return t[Math.floor(t.length*Math.random())]},randomInt:function(t,e){return t+Math.floor((1+e-t)*Math.random())},randomNumber:function(t,e){return t+(e-t)*Math.random()},squaredDistance:function(t,e,i,n){return(t-i)*(t-i)+(e-n)*(e-n)},withinRange:function(t,e,i){return t>=e&&i>=t}},n.math.Vector2D=function(){function t(e,i){if(e instanceof t)this.x=e.x,this.y=e.y;else if(2===arguments.length)this.x=e,this.y=i;else if(arguments.length>0)throw"Unexpected number of arguments for Vector2D()"}return t.prototype.x=0,t.prototype.y=0,t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.angleBetween=function(t){return Math.atan2(this.x*t.y-this.y*t.x,this.x*t.x+this.y*t.y)},t.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},t.prototype.clone=function(){return new t(this)},t.prototype.distance=function(t){return Math.sqrt((t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y))},t.prototype.distanceSq=function(t){return(t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y)},t.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},t.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y},t.prototype.crossProduct=function(t){return this.x*t.y-this.y*t.x},t.prototype.equals=function(e){return e instanceof t&&this.x==e.x&&this.y==e.y},t.prototype.perpendicular=function(e){return e=e||new t,e.setValues(-this.y,this.x)},t.prototype.getNormal=function(e,i){return i=i||new t,i.setValues(e.y-this.y,this.x-e.x).normalize()},t.prototype.isZero=function(){return 0===this.x&&0===this.y},t.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.magnitudeSq=function(){return this.x*this.x+this.y*this.y},t.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},t.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);return 0===t?(this.x=1,this.y=0):(this.x/=t,this.y/=t),this},t.prototype.scale=function(t,e){return void 0===e&&(e=t),this.x*=t,this.y*=e,this},t.prototype.scaleToMagnitude=function(t){var e=t/this.magnitude();return this.x*=e,this.y*=e,this},t.prototype.setValues=function(e,i){return e instanceof t?(this.x=e.x,this.y=e.y):(this.x=e,this.y=i),this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.toString=function(){return"Vector2D("+this.x+", "+this.y+")"},t.prototype.translate=function(t,e){return void 0===e&&(e=t),this.x+=t,this.y+=e,this},t.tripleProduct=function(t,e,i,s){s=s||new n.math.Vector2D;var r=t.dotProduct(i),o=e.dotProduct(i);return s.setValues(e.x*r-t.x*o,e.y*r-t.y*o)},t}(),n.math.Matrix2D=function(){return Matrix2D=function(t,e,i,n,s,r){if(t instanceof Matrix2D)this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f;else if(6===arguments.length)this.a=t,this.b=e,this.c=i,this.d=n,this.e=s,this.f=r;else if(arguments.length>0)throw"Unexpected number of arguments for Matrix2D()"},Matrix2D.prototype.a=1,Matrix2D.prototype.b=0,Matrix2D.prototype.c=0,Matrix2D.prototype.d=1,Matrix2D.prototype.e=0,Matrix2D.prototype.f=0,Matrix2D.prototype.apply=function(t){var e=t.x;return t.x=e*this.a+t.y*this.c+this.e,t.y=e*this.b+t.y*this.d+this.f,t},Matrix2D.prototype.clone=function(){return new Matrix2D(this)},Matrix2D.prototype.combine=function(t){var e=this.a;return this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,e=this.c,this.c=e*t.a+this.d*t.c,this.d=e*t.b+this.d*t.d,e=this.e,this.e=e*t.a+this.f*t.c+t.e,this.f=e*t.b+this.f*t.d+t.f,this},Matrix2D.prototype.equals=function(t){return t instanceof Matrix2D&&this.a==t.a&&this.b==t.b&&this.c==t.c&&this.d==t.d&&this.e==t.e&&this.f==t.f},Matrix2D.prototype.determinant=function(){return this.a*this.d-this.b*this.c},Matrix2D.prototype.invert=function(){var t=this.determinant();if(0!==t){var e={a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f};this.a=e.d/t,this.b=-e.b/t,this.c=-e.c/t,this.d=e.a/t,this.e=(e.c*e.f-e.e*e.d)/t,this.f=(e.e*e.b-e.a*e.f)/t}return this},Matrix2D.prototype.isIdentity=function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f},Matrix2D.prototype.isInvertible=function(){return 0!==this.determinant()},Matrix2D.prototype.preRotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a;return this.a=e*n-i*this.b,this.b=i*n+e*this.b,n=this.c,this.c=e*n-i*this.d,this.d=i*n+e*this.d,this},Matrix2D.prototype.preScale=function(t,e){return void 0===e&&(e=t),this.a*=t,this.b*=e,this.c*=t,this.d*=e,this},Matrix2D.prototype.preTranslate=function(t,e){return"number"==typeof t?(this.e+=t,this.f+=e):(this.e+=t.x,this.f+=t.y),this},Matrix2D.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a;return this.a=e*n-i*this.b,this.b=i*n+e*this.b,n=this.c,this.c=e*n-i*this.d,this.d=i*n+e*this.d,n=this.e,this.e=e*n-i*this.f,this.f=i*n+e*this.f,this},Matrix2D.prototype.scale=function(t,e){return void 0===e&&(e=t),this.a*=t,this.b*=e,this.c*=t,this.d*=e,this.e*=t,this.f*=e,this},Matrix2D.prototype.setValues=function(t,e,i,n,s,r){return t instanceof Matrix2D?(this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f):(this.a=t,this.b=e,this.c=i,this.d=n,this.e=s,this.f=r),this},Matrix2D.prototype.toString=function(){return"Matrix2D(["+this.a+", "+this.c+", "+this.e+"] ["+this.b+", "+this.d+", "+this.f+"] [0, 0, 1])"},Matrix2D.prototype.translate=function(t,e){return"number"==typeof t?(this.e+=this.a*t+this.c*e,this.f+=this.b*t+this.d*e):(this.e+=this.a*t.x+this.c*t.y,this.f+=this.b*t.x+this.d*t.y),this},Matrix2D}()},{"./core.js":10}],21:[function(t,e,i){var n=t("./core.js");window.document;n.c("Model",{init:function(){this.changed=[],this.bind("Change",this._changed_attributes),this.bind("Change",this._changed_triggers)},_changed_triggers:function(t,e){var i;e=n.extend.call({pre:""},e);for(i in t)this.trigger("Change["+e.pre+i+"]",t[i]),"Object"===t[i].constructor.name&&this._changed_triggers(t[i],{pre:e.pre+i+"."})},_changed_attributes:function(t){var e;for(e in t)this.changed.push(e);return this},is_dirty:function(t){return 0===arguments.length?!!this.changed.length:this.changed.indexOf(t)>-1}})},{"./core.js":10}],22:[function(t,e,i){var n=t("./core.js"),s=window.document;n.c("Particles",{init:function(){this._Particles=n.clone(this._Particles),this._Particles.parentEntity=this},particles:function(t){if(!n.support.canvas||n.deactivateParticles)return this;var e,i,r,o,a;e=s.createElement("canvas"),e.width=n.viewport.width,e.height=n.viewport.height,e.style.position="absolute",e.style.left="0px",e.style.top="0px",n.stage.elem.appendChild(e),i=e.getContext("2d"),this._Particles.init(t),this.bind("Remove",function(){n.stage.elem.removeChild(e)}).bind("RemoveComponent",function(t){"particles"===t&&n.stage.elem.removeChild(e)}),r=this.x+n.viewport.x,o=this.y+n.viewport.y,this._Particles.position=this._Particles.vectorHelpers.create(r,o);var h={x:n.viewport.x,y:n.viewport.y};return this.bind("EnterFrame",function(){r=this.x+n.viewport.x,o=this.y+n.viewport.y,this._Particles.viewportDelta={x:n.viewport.x-h.x,y:n.viewport.y-h.y},h={x:n.viewport.x,y:n.viewport.y},this._Particles.position=this._Particles.vectorHelpers.create(r,o),"function"==typeof n.DrawManager.boundingRect?(a=n.DrawManager.boundingRect(this._Particles.register),a&&i.clearRect(a._x,a._y,a._w,a._h)):i.clearRect(0,0,n.viewport.width,n.viewport.height),this._Particles.update(),this._Particles.render(i)}),this},_Particles:{presets:{maxParticles:150,size:18,sizeRandom:4,speed:1,speedRandom:1.2,lifeSpan:29,lifeSpanRandom:7,angle:65,angleRandom:34,startColour:[255,131,0,1],startColourRandom:[48,50,45,0],endColour:[245,35,0,0],endColourRandom:[60,60,60,0],sharpness:20,sharpnessRandom:10,spread:10,duration:-1,fastMode:!1,gravity:{x:0,y:.1},jitter:0,particles:[],active:!0,particleCount:0,elapsedFrames:0,emissionRate:0,emitCounter:0,particleIndex:0},init:function(t){this.position=this.vectorHelpers.create(0,0),"undefined"==typeof t&&(t={});for(var e in this.presets)"undefined"!=typeof t[e]?this[e]=t[e]:this[e]=this.presets[e];this.emissionRate=this.maxParticles/this.lifeSpan,this.positionRandom=this.vectorHelpers.create(this.spread,this.spread)},addParticle:function(){if(this.particleCount==this.maxParticles)return!1;var t=new this.particle(this.vectorHelpers);return this.initParticle(t),this.particles[this.particleCount]=t,this.particleCount++,!0},RANDM1TO1:function(){return 2*Math.random()-1},initParticle:function(t){t.position.x=this.position.x+this.positionRandom.x*this.RANDM1TO1(),t.position.y=this.position.y+this.positionRandom.y*this.RANDM1TO1();var e=(this.angle+this.angleRandom*this.RANDM1TO1())*(Math.PI/180),i=this.vectorHelpers.create(Math.sin(e),-Math.cos(e)),n=this.speed+this.speedRandom*this.RANDM1TO1();t.direction=this.vectorHelpers.multiply(i,n),t.size=this.size+this.sizeRandom*this.RANDM1TO1(),t.size=t.size<0?0:~~t.size,t.timeToLive=this.lifeSpan+this.lifeSpanRandom*this.RANDM1TO1(),t.sharpness=this.sharpness+this.sharpnessRandom*this.RANDM1TO1(),t.sharpness=t.sharpness>100?100:t.sharpness<0?0:t.sharpness,t.sizeSmall=~~(t.size/200*t.sharpness);var s=[this.startColour[0]+this.startColourRandom[0]*this.RANDM1TO1(),this.startColour[1]+this.startColourRandom[1]*this.RANDM1TO1(),this.startColour[2]+this.startColourRandom[2]*this.RANDM1TO1(),this.startColour[3]+this.startColourRandom[3]*this.RANDM1TO1()],r=[this.endColour[0]+this.endColourRandom[0]*this.RANDM1TO1(),this.endColour[1]+this.endColourRandom[1]*this.RANDM1TO1(),this.endColour[2]+this.endColourRandom[2]*this.RANDM1TO1(),this.endColour[3]+this.endColourRandom[3]*this.RANDM1TO1()];t.colour=s,t.deltaColour[0]=(r[0]-s[0])/t.timeToLive,t.deltaColour[1]=(r[1]-s[1])/t.timeToLive,t.deltaColour[2]=(r[2]-s[2])/t.timeToLive,t.deltaColour[3]=(r[3]-s[3])/t.timeToLive},update:function(){if(this.active&&this.emissionRate>0){var t=1/this.emissionRate;for(this.emitCounter++;this.particleCount<this.maxParticles&&this.emitCounter>t;)this.addParticle(),this.emitCounter-=t;this.elapsedFrames++,-1!=this.duration&&this.duration<this.elapsedFrames&&this.stop()}this.particleIndex=0,this.register=[];for(var e;this.particleIndex<this.particleCount;){var i=this.particles[this.particleIndex];if(i.timeToLive>0){i.direction=this.vectorHelpers.add(i.direction,this.gravity),i.position=this.vectorHelpers.add(i.position,i.direction),i.position=this.vectorHelpers.add(i.position,this.viewportDelta),this.jitter&&(i.position.x+=this.jitter*this.RANDM1TO1(),i.position.y+=this.jitter*this.RANDM1TO1()),i.timeToLive--;var n=i.colour[0]+=i.deltaColour[0],s=i.colour[1]+=i.deltaColour[1],r=i.colour[2]+=i.deltaColour[2],o=i.colour[3]+=i.deltaColour[3];e=[],e.push("rgba("+(n>255?255:0>n?0:~~n)),e.push(s>255?255:0>s?0:~~s),e.push(r>255?255:0>r?0:~~r),e.push((o>1?1:0>o?0:o.toFixed(2))+")"),i.drawColour=e.join(","),this.fastMode||(e[3]="0)",i.drawColourEnd=e.join(",")),this.particleIndex++}else this.particleIndex!=this.particleCount-1&&(this.particles[this.particleIndex]=this.particles[this.particleCount-1]),this.particleCount--;var a={};a._x=~~i.position.x,a._y=~~i.position.y,a._w=i.size,a._h=i.size,this.register.push(a)}},stop:function(){this.active=!1,this.elapsedFrames=0,this.emitCounter=0,this.parentEntity.trigger("ParticleEnd")},render:function(t){for(var e=0,i=this.particleCount;i>e;e++){var s=this.particles[e],r=s.size,o=r>>1;if(!(s.position.x+r<0||s.position.y+r<0||s.position.x-r>n.viewport.width||s.position.y-r>n.viewport.height)){var a=~~s.position.x,h=~~s.position.y;if(this.fastMode)t.fillStyle=s.drawColour;else{var c=t.createRadialGradient(a+o,h+o,s.sizeSmall,a+o,h+o,o);c.addColorStop(0,s.drawColour),c.addColorStop(.9,s.drawColourEnd),t.fillStyle=c}t.fillRect(a,h,r,r)}}},particle:function(t){this.position=t.create(0,0),this.direction=t.create(0,0),this.size=0,this.sizeSmall=0,this.timeToLive=0,this.colour=[],this.drawColour="",this.deltaColour=[],this.sharpness=0},vectorHelpers:{create:function(t,e){return{x:t,y:e}},multiply:function(t,e){return t.x*=e,t.y*=e,t},add:function(t,e){return t.x+=e.x,t.y+=e.y,t}}}})},{"./core.js":10}],23:[function(t,e,i){var n=t("./core.js");window.document;n.extend({_scenes:{},_current:null,scene:function(t,e,i){return 1===arguments.length||"function"!=typeof arguments[1]?void n.enterScene(t,arguments[1]):void n.defineScene(t,e,i)},defineScene:function(t,e,i){if("function"!=typeof e)throw"Init function is the wrong type.";this._scenes[t]={},this._scenes[t].initialize=e,"undefined"!=typeof i&&(this._scenes[t].uninitialize=i)},enterScene:function(t,e){if("function"==typeof e)throw"Scene data cannot be a function";n.trigger("SceneDestroy",{newScene:t}),n.viewport.reset(),n("2D").each(function(){this.has("Persist")||this.destroy()}),null!==this._current&&"uninitialize"in this._scenes[this._current]&&this._scenes[this._current].uninitialize.call(this);var i=this._current;this._current=t,n.trigger("SceneChange",{oldScene:i,newScene:t}),this._scenes[t].initialize.call(this,e)}})},{"./core.js":10}],24:[function(t,e,i){var n=t("./core.js"),s=window.document;n.extend({audio:{sounds:{},supported:null,codecs:{ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',webma:'audio/webm; codecs="vorbis"',mp3:'audio/mpeg; codecs="mp3"',m4a:'audio/mp4; codecs="mp4a.40.2"'},volume:1,muted:!1,paused:!1,playCheck:null,_canPlay:function(){if(this.supported={},n.support.audio){var t,e=this.audioElement();for(var i in this.codecs)t=e.canPlayType(this.codecs[i]),""!==t&&"no"!==t?this.supported[i]=!0:this.supported[i]=!1}},supports:function(t){return null===this.supported&&this._canPlay(),this.supported[t]?!0:!1},audioElement:function(){return"undefined"!=typeof Audio?new Audio(""):s.createElement("audio")},create:function(t,e){var i=e.substr(e.lastIndexOf(".")+1).toLowerCase();if(!this.supports(i))return!1;var s=this.audioElement();return s.id=t,s.preload="auto",s.volume=n.audio.volume,s.src=e,n.asset(e,s),this.sounds[t]={obj:s,played:0,volume:n.audio.volume},this.sounds[t]},add:function(t,e){if(n.support.audio){var i,s;if(1===arguments.length&&"object"==typeof t)for(var r in t)for(i in t[r])if(s=n.audio.create(r,t[r][i]))break;if("string"==typeof t&&("string"==typeof e&&(s=n.audio.create(t,e)),"object"==typeof e))for(i in e)if(s=n.audio.create(t,e[i]))break;return s}},play:function(t,e,i){if(0!==e&&n.support.audio&&this.sounds[t]){var s=this.sounds[t],r=this.getOpenChannel();if(!r)return null;r.id=t,r.repeat=e;var o=r.obj;return r.volume=s.volume=s.obj.volume=i||n.audio.volume,o.volume=s.volume,o.src=s.obj.src,this.muted&&(o.volume=0),o.play(),s.played++,r.onEnd=function(){s.played<r.repeat||-1==e?(this.currentTime&&(this.currentTime=0),this.play(),s.played++):(r.active=!1,this.pause(),this.removeEventListener("ended",r.onEnd,!0),this.currentTime=0,n.trigger("SoundComplete",{id:r.id}))},o.addEventListener("ended",r.onEnd,!0),o}},maxChannels:7,setChannels:function(t){this.maxChannels=t,t<this.channels.length&&(this.channels.length=t)},channels:[],getOpenChannel:function(){for(var t=0;t<this.channels.length;t++){var e=this.channels[t];if(e.active===!1||e.obj.ended&&e.repeat<=this.sounds[e.id].played)return e.active=!0,e}if(t<this.maxChannels){var i={obj:this.audioElement(),active:!0,_is:function(t){return this.id===t&&this.active}};return this.channels.push(i),i}return null},remove:function(t){if(n.support.audio){var e,i,s=n.paths().audio;if(t)this.sounds[t]&&(e=this.sounds[t],i=e.obj.src.split("/").pop(),n.audio.stop(t),delete n.assets[s+i],delete n.assets[e.obj.src],delete n.audio.sounds[t]);else for(var r in this.sounds)e=this.sounds[r],i=e.obj.src.split("/").pop(),n.audio.stop(t),delete n.assets[s+i],delete n.assets[e.obj.src],delete n.audio.sounds[t]}},stop:function(t){if(n.support.audio)for(var e in this.channels)c=this.channels[e],(!t&&c.active||c._is(t))&&(c.active=!1,c.obj.pause())},_mute:function(t){if(n.support.audio){var e;for(var i in this.channels)e=this.channels[i],e.obj.volume=t?0:e.volume;this.muted=t}},toggleMute:function(){this.muted?this._mute(!1):this._mute(!0)},mute:function(){this._mute(!0)},unmute:function(){this._mute(!1)},pause:function(t){if(n.support.audio&&t&&this.sounds[t]){var e;for(var i in this.channels)e=this.channels[i],e._is(t)&&!e.obj.paused&&e.obj.pause()}},unpause:function(t){if(n.support.audio&&t&&this.sounds[t]){var e;for(var i in this.channels)e=this.channels[i],e._is(t)&&e.obj.paused&&e.obj.play()}},togglePause:function(t){if(n.support.audio&&t&&this.sounds[t]){var e;for(var i in this.channels)e=this.channels[i],e._is(t)&&(e.obj.paused?e.obj.play():e.obj.pause())}},isPlaying:function(t){if(!n.support.audio)return!1;for(var e in this.channels)if(this.channels[e]._is(t))return!0;return!1}}})},{"./core.js":10}],25:[function(t,e,i){var n=t("./core.js");t("./animation.js"),window.document;n.c("SpriteAnimation",{_reels:null,_currentReelId:null,_currentReel:null,_isPlaying:!1,animationSpeed:1,init:function(){this._reels={}},reel:function(t,e,i,s,r){if(0===arguments.length)return this._currentReelId;if(1===arguments.length&&"string"==typeof t){if("undefined"==typeof this._reels[t])throw"The specified reel "+t+" is undefined.";return this.pauseAnimation(),this._currentReelId!==t&&(this._currentReelId=t,this._currentReel=this._reels[t],this._updateSprite(),this.trigger("ReelChange",this._currentReel)),this}var o,a;if(o={id:t,frames:[],currentFrame:0,easing:new n.easing(e),defaultLoops:1},o.duration=o.easing.duration,"number"==typeof i)if(a=i,y=s,r>=0)for(;i+r>a;a++)o.frames.push([a,y]);else for(;a>i+r;a--)o.frames.push([a,y]);else{if(3!==arguments.length||"object"!=typeof i)throw"Urecognized arguments. Please see the documentation for 'reel(...)'.";o.frames=i}return this._reels[t]=o,this},animate:function(t,e){"string"==typeof t&&this.reel(t);var i=this._currentReel;if("undefined"==typeof i||null===i)throw"No reel is specified, and there is no currently active reel.";return this.pauseAnimation(),"undefined"==typeof e&&(e="number"==typeof t?t:1),i.easing.reset(),this.loops(e),this._setFrame(0),this.bind("EnterFrame",this._animationTick),this._isPlaying=!0,this.trigger("StartAnimation",i),this},resumeAnimation:function(){return this._isPlaying===!1&&null!==this._currentReel&&(this.bind("EnterFrame",this._animationTick),this._isPlaying=!0,this._currentReel.easing.resume(),this.trigger("StartAnimation",this._currentReel)),this},pauseAnimation:function(){return this._isPlaying===!0&&(this.unbind("EnterFrame",this._animationTick),this._isPlaying=!1,this._reels[this._currentReelId].easing.pause()),this},resetAnimation:function(){var t=this._currentReel;if(null===t)throw"No active reel to reset.";return this.reelPosition(0),t.easing.repeat(t.defaultLoops),this},loops:function(t){return 0===arguments.length?null!==this._currentReel?this._currentReel.easing.loops:0:(null!==this._currentReel&&(0>t&&(t=1/0),this._currentReel.easing.repeat(t),this._currentReel.defaultLoops=t),this)},reelPosition:function(t){if(null===this._currentReel)throw"No active reel.";if(0===arguments.length)return this._currentReel.currentFrame;var e,i=this._currentReel.frames.length;if("end"===t&&(t=i-1),1>t&&t>0)e=t,t=Math.floor(i*e);else{if(t!==Math.floor(t))throw"Position "+t+" is invalid.";0>t&&(t=i-1+t),e=t/i}return t=Math.min(t,i-1),t=Math.max(t,0),this._setProgress(e),this._setFrame(t),this},_animationTick:function(t){var e=this._reels[this._currentReelId];e.easing.tick(t.dt*this.animationSpeed);var i=e.easing.value(),n=Math.min(Math.floor(e.frames.length*i),e.frames.length-1);this._setFrame(n),e.easing.complete===!0&&(this.pauseAnimation(),this.trigger("AnimationEnd",this._currentReel))},_setFrame:function(t){var e=this._currentReel;t!==e.currentFrame&&(e.currentFrame=t,this._updateSprite(),this.trigger("FrameChange",e))},_updateSprite:function(){var t=this._currentReel,e=t.frames[t.currentFrame];this.sprite(e[0],e[1])},_setProgress:function(t,e){this._currentReel.easing.setProgress(t,e)},isPlaying:function(t){return this._isPlaying?t?this._currentReelId===t:!!this._currentReelId:!1},getReel:function(t){if(0===arguments.length){if(!this._currentReelId)return null;t=this._currentReelId}return this._reels[t]}})},{"./animation.js":5,"./core.js":10}],26:[function(t,e,i){var n=t("./core.js");window.document;n.extend({sprite:function(t,e,i,s,r,o,a){var h,c,u;"string"==typeof t&&(o=r,r=s,s=e,i=t,t=1,e=1),"string"==typeof e&&(o=r,r=s,s=i,i=e,e=t),!o&&r&&(o=r),r=parseInt(r||0,10),o=parseInt(o||0,10);var l=function(){this.ready=!0,this.trigger("Invalidate")};u=n.asset(i),u||(u=new Image,u.src=i,n.asset(i,u),u.onload=function(){for(var t in s)n(t).each(l)});var d=function(){this.requires("2D, Sprite"),this.__trim=[0,0,0,0],this.__image=i,this.__coord=[this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]],this.__tile=t,this.__tileh=e,this.__padding=[r,o],this.__padBorder=a,this.sprite(this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]),this.img=u,this.img.complete&&this.img.width>0&&(this.ready=!0,this.trigger("Invalidate")),this.w=this.__coord[2],this.h=this.__coord[3]};for(h in s)s.hasOwnProperty(h)&&(c=s[h],n.c(h,{ready:!1,__coord:[c[0],c[1],c[2]||1,c[3]||1],init:d}));return this}}),n.c("Sprite",{__image:"",__tile:0,__tileh:0,__padding:null,__trim:null,img:null,ready:!1,init:function(){this.__trim=[0,0,0,0];var t=function(t){var e=t.co,i=t.pos,n=t.ctx;if("canvas"===t.type)n.drawImage(this.img,e.x,e.y,e.w,e.h,i._x,i._y,i._w,i._h);else if("DOM"===t.type){var s=this._h/e.h,r=this._w/e.w,o=this._element.style;o.background=o.backgroundColor+" url('"+this.__image+"') no-repeat",o.backgroundPosition="-"+e.x*r+"px -"+e.y*s+"px",(1!=s||1!=r)&&(o.backgroundSize=this.img.width*r+"px "+this.img.height*s+"px")}};this.bind("Draw",t).bind("RemoveComponent",function(e){"Sprite"===e&&this.unbind("Draw",t)})},sprite:function(t,e,i,n){return this.__coord=this.__coord||[0,0,0,0],this.__coord[0]=t*(this.__tile+this.__padding[0])+(this.__padBorder?this.__padding[0]:0)+this.__trim[0],this.__coord[1]=e*(this.__tileh+this.__padding[1])+(this.__padBorder?this.__padding[1]:0)+this.__trim[1],"undefined"!=typeof i&&"undefined"!=typeof n&&(this.__coord[2]=this.__trim[2]||i*this.__tile||this.__tile,this.__coord[3]=this.__trim[3]||n*this.__tileh||this.__tileh),this.trigger("Invalidate"),this},crop:function(t,e,i,n){var s=this._mbr||this.pos();return this.__trim=[],this.__trim[0]=t,this.__trim[1]=e,this.__trim[2]=i,this.__trim[3]=n,this.__coord[0]+=t,this.__coord[1]+=e,this.__coord[2]=i,this.__coord[3]=n,this._w=i,this._h=n,this.trigger("Invalidate",s),this}})},{"./core.js":10}],27:[function(t,e,i){var n=t("./core.js");window.document;n.storage=function(t,e){var i=window.localStorage,n=e;if(!i)return!1;if(1===arguments.length)try{return JSON.parse(i.getItem(t))}catch(s){return i.getItem(t)}else"object"==typeof e&&(n=JSON.stringify(e)),i.setItem(t,n)},n.storage.remove=function(t){window.localStorage.removeItem(t)}},{"./core.js":10}],28:[function(t,e,i){var n=t("./core.js");window.document;n.c("Text",{_text:"",defaultSize:"10px",defaultFamily:"sans-serif",defaultVariant:"normal",defaultLineHeight:"normal",ready:!0,init:function(){this.requires("2D"),this._textFont={type:"",weight:"",size:this.defaultSize,lineHeight:this.defaultLineHeight,family:this.defaultFamily,variant:this.defaultVariant},this.bind("Draw",function(t){var e=this._fontString();if("DOM"===t.type){var i=this._element,n=i.style;n.color=this._textColor,n.font=e,i.innerHTML=this._text}else if("canvas"===t.type){var s=t.ctx;s.save(),s.textBaseline="top",s.fillStyle=this._textColor||"rgb(0,0,0)",s.font=e,s.fillText(this._text,t.pos._x,t.pos._y),s.restore()}})},_getFontHeight:function(){var t=/([a-zA-Z]+)\b/,e={px:1,pt:4/3,pc:16,cm:96/2.54,mm:96/25.4,"in":96,em:void 0,ex:void 0};return function(i){var n=parseFloat(i),s=t.exec(i),r=s?s[1]:"px";return void 0!==e[r]?Math.ceil(n*e[r]):Math.ceil(n)}}(),text:function(t){return"undefined"==typeof t||null===t?this._text:("function"==typeof t?this._text=t.call(this):this._text=t,this.has("Canvas")&&this._resizeForCanvas(),this.trigger("Invalidate"),this)},_resizeForCanvas:function(){var t=n.canvas.context;t.font=this._fontString(),this.w=t.measureText(this._text).width;var e=this._textFont.size||this.defaultSize;this.h=1.1*this._getFontHeight(e)},_fontString:function(){return this._textFont.type+" "+this._textFont.variant+" "+this._textFont.weight+" "+this._textFont.size+" / "+this._textFont.lineHeight+" "+this._textFont.family},textColor:function(t){return n.assignColor(t,this),this._textColor="rgba("+this._red+", "+this._green+", "+this._blue+", "+this._strength+")",this.trigger("Invalidate"),this},textFont:function(t,e){if(1===arguments.length){if("string"==typeof t)return this._textFont[t];if("object"==typeof t)for(var i in t)"family"==i?this._textFont[i]="'"+t[i]+"'":this._textFont[i]=t[i]}else this._textFont[t]=e;return this.has("Canvas")&&this._resizeForCanvas(),this.trigger("Invalidate"),this},unselectable:function(){return this.has("DOM")&&(this.css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"default"}),this.trigger("Invalidate")),this}})},{"./core.js":10}],29:[function(t,e,i){var n=t("./core.js");window.document;n.c("Delay",{init:function(){this._delays=[],this.bind("EnterFrame",function(t){for(var e=this._delays.length;--e>=0;){var i=this._delays[e];if(i===!1)this._delays.splice(e,1);else{for(i.accumulator+=t.dt;i.accumulator>=i.delay&&i.repeat>=0;)i.accumulator-=i.delay,i.repeat--,i.callback.call(this);i.repeat<0&&(this._delays.splice(e,1),"function"==typeof i.callbackOff&&i.callbackOff.call(this))}}})},delay:function(t,e,i,n){return this._delays.push({accumulator:0,callback:t,callbackOff:n,delay:e,repeat:(0>i?1/0:i)||0}),this},cancelDelay:function(t){for(var e=this._delays.length;--e>=0;){var i=this._delays[e];i&&i.callback==t&&(this._delays[e]=!1)}return this}})},{"./core.js":10}],30:[function(t,e,i){e.exports="0.6.2"},{}],31:[function(t,e,i){var n=t("./core.js"),s=window.document;n.extend({viewport:{clampToEntities:!0,_width:0,_height:0,_x:0,_y:0,_scale:1,bounds:null,scroll:function(t,e){this[t]=e,n.trigger("ViewportScroll"),n.trigger("InvalidateViewport")},rect_object:{_x:0,_y:0,_w:0,_h:0},rect:function(){return this.rect_object._x=-this._x,this.rect_object._y=-this._y,this.rect_object._w=this._width/this._scale,this.rect_object._h=this._height/this._scale,this.rect_object},pan:function(){function t(t){a.tick(t.dt);var h=a.value();n.viewport.x=(1-h)*r+h*i,n.viewport.y=(1-h)*o+h*s,n.viewport._clamp(),a.complete&&(e(),n.trigger("CameraAnimationDone"))}function e(){n.unbind("EnterFrame",t)}var i,s,r,o,a;return n.bind("StopCamera",e),function(e,h,c){n.trigger("StopCamera"),"reset"!=e&&(r=n.viewport._x,o=n.viewport._y,i=r-e,s=o-h,a=new n.easing(c),n.uniqueBind("EnterFrame",t))}}(),follow:function(){function t(){n.viewport.scroll("_x",-(this.x+this.w/2-n.viewport.width/2-s)),n.viewport.scroll("_y",-(this.y+this.h/2-n.viewport.height/2-r)),n.viewport._clamp()}function e(){i&&i.unbind("Move",t)}var i,s,r;return n.bind("StopCamera",e),function(e,o,a){e&&e.has("2D")&&(n.trigger("StopCamera"),i=e,s="undefined"!=typeof o?o:0,r="undefined"!=typeof a?a:0,e.bind("Move",t),t.call(e))}}(),centerOn:function(t,e){var i=t.x+n.viewport.x,s=t.y+n.viewport.y,r=t.w/2,o=t.h/2,a=n.viewport.width/2,h=n.viewport.height/2,c=i+r-a,u=s+o-h;n.viewport.pan(c,u,e)},zoom:function(){function t(){n.unbind("EnterFrame",e)}function e(e){var s,l;u.tick(e.dt),s=Math.pow(r,u.value()),l=1===r?u.value():(1/s-1)/(1/r-1),n.viewport.scale(s*i),n.viewport.scroll("_x",o*(1-l)+a*l),n.viewport.scroll("_y",h*(1-l)+c*l),n.viewport._clamp(),u.complete&&(t(),n.trigger("CameraAnimationDone"))}n.bind("StopCamera",t);var i,s,r,o,a,h,c,u;return function(t,l,d,_){return t?(arguments.length<=2&&(_=l,l=n.viewport.x-n.viewport.width,d=n.viewport.y-n.viewport.height),n.trigger("StopCamera"),i=n.viewport._scale,r=t,s=i*r,o=n.viewport.x,h=n.viewport.y,a=-(l-n.viewport.width/(2*s)),c=-(d-n.viewport.height/(2*s)),u=new n.easing(_),void n.uniqueBind("EnterFrame",e)):void n.viewport.scale(1)}}(),scale:function(){return function(t){this._scale=t?t:1,n.trigger("InvalidateViewport"),n.trigger("ViewportScale")}}(),mouselook:function(){var t=!1,e=!1,i={};return old={},function(s,r){if("boolean"==typeof s)return t=s,void(t?n.mouseObjs++:n.mouseObjs=Math.max(0,n.mouseObjs-1));if(t)switch(s){case"move":case"drag":if(!e)return;diff={x:r.clientX-i.x,y:r.clientY-i.y},i.x=r.clientX,i.y=r.clientY,n.viewport.x+=diff.x,n.viewport.y+=diff.y,n.viewport._clamp();break;case"start":n.trigger("StopCamera"),i.x=r.clientX,i.y=r.clientY,e=!0;break;case"stop":e=!1}}}(),_clamp:function(){if(this.clampToEntities){var t=this.bounds||n.map.boundaries();t.max.x*=this._scale,t.min.x*=this._scale,t.max.y*=this._scale,t.min.y*=this._scale,t.max.x-t.min.x>n.viewport.width?n.viewport.x<-t.max.x+n.viewport.width?n.viewport.x=-t.max.x+n.viewport.width:n.viewport.x>-t.min.x&&(n.viewport.x=-t.min.x):n.viewport.x=-1*(t.min.x+(t.max.x-t.min.x)/2-n.viewport.width/2),
t.max.y-t.min.y>n.viewport.height?n.viewport.y<-t.max.y+n.viewport.height?n.viewport.y=-t.max.y+n.viewport.height:n.viewport.y>-t.min.y&&(n.viewport.y=-t.min.y):n.viewport.y=-1*(t.min.y+(t.max.y-t.min.y)/2-n.viewport.height/2)}},init:function(t,e,i){n.DOM.window.init(),this._defineViewportProperties(),this._width=t?t:n.DOM.window.width,this._height=e?e:n.DOM.window.height,"undefined"==typeof i&&(i="cr-stage");var r;if("string"==typeof i)r=s.getElementById(i);else{if(!("undefined"!=typeof HTMLElement?i instanceof HTMLElement:i instanceof Element))throw new TypeError("stage_elem must be a string or an HTMLElement");r=i}n.stage={x:0,y:0,fullscreen:!1,elem:r?r:s.createElement("div"),inner:s.createElement("div")},t||e||(s.body.style.overflow="hidden",n.stage.fullscreen=!0),n.addEvent(this,window,"resize",n.viewport.reload),n.addEvent(this,window,"blur",function(){n.settings.get("autoPause")&&(n._paused||n.pause())}),n.addEvent(this,window,"focus",function(){n._paused&&n.settings.get("autoPause")&&n.pause()}),n.settings.register("stageSelectable",function(t){n.stage.elem.onselectstart=t?function(){return!0}:function(){return!1}}),n.settings.modify("stageSelectable",!1),n.settings.register("stageContextMenu",function(t){n.stage.elem.oncontextmenu=t?function(){return!0}:function(){return!1}}),n.settings.modify("stageContextMenu",!1),n.settings.register("autoPause",function(){}),n.settings.modify("autoPause",!1),r||(s.body.appendChild(n.stage.elem),n.stage.elem.id=i);var o,a=n.stage.elem.style;if(n.stage.elem.appendChild(n.stage.inner),n.stage.inner.style.position="absolute",n.stage.inner.style.zIndex="1",n.stage.inner.style.transformStyle="preserve-3d",a.width=this.width+"px",a.height=this.height+"px",a.overflow="hidden",n.bind("ViewportResize",function(){n.trigger("InvalidateViewport")}),n.mobile){void 0!==typeof a.webkitTapHighlightColor&&(a.webkitTapHighlightColor="rgba(0,0,0,0)");var h=s.createElement("meta"),c=s.getElementsByTagName("head")[0];h=s.createElement("meta"),h.setAttribute("name","apple-mobile-web-app-capable"),h.setAttribute("content","yes"),c.appendChild(h),n.addEvent(this,n.stage.elem,"touchmove",function(t){t.preventDefault()})}else a.position="relative",o=n.DOM.inner(n.stage.elem),n.stage.x=o.x,n.stage.y=o.y},_defineViewportProperties:function(){Object.defineProperty(this,"x",{set:function(t){this.scroll("_x",t)},get:function(){return this._x},configurable:!0}),Object.defineProperty(this,"y",{set:function(t){this.scroll("_y",t)},get:function(){return this._y},configurable:!0}),Object.defineProperty(this,"width",{set:function(t){this._width=t,n.trigger("ViewportResize")},get:function(){return this._width},configurable:!0}),Object.defineProperty(this,"height",{set:function(t){this._height=t,n.trigger("ViewportResize")},get:function(){return this._height},configurable:!0})},reload:function(){n.DOM.window.init();var t,e=n.DOM.window.width,i=n.DOM.window.height;n.stage.fullscreen&&(this._width=e,this._height=i,n.trigger("ViewportResize")),t=n.DOM.inner(n.stage.elem),n.stage.x=t.x,n.stage.y=t.y},reset:function(){n.viewport.mouselook("stop"),n.trigger("StopCamera"),n.viewport.scale(1)}}})},{"./core.js":10}],32:[function(t,e,i){var n=t("craftyjs"),s=!1;$(function(){function e(t,e,i){e=t-e-1,e%3===0&&$(i).addClass("-right"),(e+1)%3===0&&$(i).addClass("-left")}function i(t,e,i){i=i||"red";var n=_.getContext("2d"),s=Math.floor(_.width*(t/e))-.5;n.beginPath();var r=n.createLinearGradient(0,0,0,f.height);r.addColorStop(0,"rgb(121, 0, 0)"),r.addColorStop(.5,i),r.addColorStop(1,"rgb(121, 0, 0)"),n.strokeStyle=r,n.lineWidth=1,n.moveTo(s,0),n.lineTo(s,Math.round(.75*_.height)),n.stroke()}function r(t,e,i){i=i||"cyan";var n=f.getContext("2d");n.clearRect(0,0,f.width,f.height);var s=n.createLinearGradient(0,0,0,f.height);s.addColorStop(0,i),s.addColorStop(1,"rgb(0, 199, 205)"),n.fillStyle=s;var r=Math.min(f.width*(t/e),f.width);n.fillRect(0,0,r,f.height)}function o(t){var e=$(".loop-counter .digit").toArray();for(t=t.toString();t.length<4;)t="0"+t;t.length>4&&(t="10k+");for(var i=0;4>i;++i)e[i].innerHTML=t[i]}function a(){if(document.pointerLockElement===n.stage.elem){if(!O)return;O=!1,S.enableMouse()}else O=!0,S.enableKeyboard()}function h(){}function c(t){this._firstFrame=t.frame}function u(t){this._previousFrames[t.frame]={x:this.x,y:this.y}}$(".counter.-separate").each(function(t,i){var n=$(i).children(),s=n.filter(".digit");s.each(function(t,i){e(s.length,t,i)})});var l=$(".timeline"),d=$("#tb-display")[0],_=$("#tb-hits")[0],f=$("#tb-progress")[0],p=l.width(),g=.8*l.parent().height();l.height(g),d.width=_.width=f.width=p,d.height=_.height=f.height=g;var m=d.getContext("2d");m.lineWidth=1,m.lineCap="round",m.strokeStyle="#666";for(var y=32,v=2;y>=v;v*=2)for(var x=1;v>x;x++){m.beginPath(),m.moveTo(Math.round(p/v*x)+.5,g);var w=Math.log(v)/Math.log(y*y);m.lineTo(Math.round(p/v*x)+.5,Math.round(g*w+1*g/4)),m.stroke()}var b=$("#animated-sansa"),M=b.width(),D=b.height(),C=20,R=100,E=8,k=5,P=4;n.init(M,D,"animated-sansa"),n.background("black"),n.c("Quark",{init:function(){this.requires("2D, DOM, Color, Collision"),this.attr({x:M/2-k,y:D/2-k,w:2*k,h:2*k}),this.css("border-radius","100%"),this.origin("center"),this.collision(new n.circle(k,k,k))}}),n.c("GameClock",{_dt:0,_gameEnd:0,init:function(){this.requires("2D")},_enterFrame:function(t){r(this._dt,this._gameEnd),this._dt+=t.dt},gameClock:function(t){return this._gameEnd=t,this.bind("EnterFrame",this._enterFrame),this},reset:function(){return this._dt=0,this}}),t("./player")(n,M,D,E,C),t("./ghosts")(n),t("./tachyons")(n,M,D,C,R,P),t("./spawner")(n,M,D,C,R,P);var S=n.e("Player");b.on("click",function(){this.requestPointerLock()});var O=!0;$(document).on("pointerlockchange",a),$(document).on("pointerlockerror",h);var j,T,F=1;n.scene("Start",function(){F=1,o(F++),setTimeout(function(){n.scene("Loop")},2e3)},function(){T=n.e("Spawner").spawner(18e4)}),n.scene("Loop",function(){s&&n("Quark").each(function(){this.addComponent("WiredHitBox")}),S.one("ExitFrame",c),S.bind("ExitFrame",u),j=n.e("GameClock").gameClock(18e4),n.trigger("StartGhosts"),T.start()},function(){i(j._dt,j._gameEnd),j.reset(),T.reset(),S.unbind("ExitFrame",u);var t=S._firstFrame||0,e=S._previousFrames||[];S._previousFrames=[];var s=S._tachId;S._tachId=void 0,n.trigger("ResetGhosts"),0!==e.length&&n.e("Ghost").Ghost(s,t,e)}),n.scene("Scratch",function(){o(F++),setTimeout(function(){n.scene("Loop")},2e3)}),n.scene("GameOver",function(){n("Quark").each(function(){this.destroy()}),n.e("2D, DOM, Text").attr({x:100,y:100}).text("Game Over").textColor("#ffffff").textFont("Open Sans")}),s&&(n("Quark").each(function(){this.addComponent("WiredHitBox")}),S.addComponent("Keyboard"),S.bind("KeyDown",function(t){t.key===n.keys.R?(this.x=M/2-k,this.y=D/2-k):t.key===n.keys.Q?console.log(this.x,this.y):t.key===n.keys.C&&"Loop"===n._current&&n.scene("Scratch")})),n.scene("Start")})},{"./ghosts":33,"./player":34,"./spawner":35,"./tachyons":36,craftyjs:11}],33:[function(t,e,i){e.exports=function(t){t.c("Ghost",{_f:0,_tachId:0,init:function(){this.requires("Quark, Persist, Tween"),this.color("grey"),this.bind("ResetGhosts",this.reset),this.bind("StartGhosts",this.start),this.bind("PlaybackEnd",this._playbackEnd),this.z=100},_init:function(){this._f=this._firstFrame,this.attr({x:this._previousFrames[this._firstFrame].x,y:this._previousFrames[this._firstFrame].y,z:100,alpha:1})},_playbackEnd:function(){this.color("rgb(117, 27, 192)"),this.z=150,this.removeComponent("Active"),this.tween({alpha:0},200)},Ghost:function(t,e,i){this._firstFrame=e,this._previousFrames=i,this._tachId=t,this._init()},reset:function(){this.removeComponent("Active"),this.color("grey"),this.cancelTween("alpha"),this.alpha=1,this._init()},start:function(){this.addComponent("Active")}}),t.c("Active",{init:function(){this.requires("Ghost"),this.color("red"),this.bind("EnterFrame",this._enterFrame),this.z=500},remove:function(){this.unbind("EnterFrame",this._enterFrame),this.ignoreHits("Tachyon")},_enterFrame:function(){var t=this.hit("Tachyon");if(t&&this._removeStray(t,"prev"),this._f>=this._previousFrames.length)return void this.trigger("PlaybackEnd");var e=this._previousFrames[this._f++];this.x=e.x,this.y=e.y,t=this.hit("Tachyon"),t&&this._removeStray(t,"post")},_removeStray:function(t,e){var i=this;t.forEach(function(t){console.log(e,t.obj.id,i._tachId),t.obj.destroy()})}})}},{}],34:[function(t,e,i){e.exports=function(t,e,i,n,s){t.c("PointerWay",{init:function(){var e=this;this._mouseMovement={x:0,y:0},this._mouseSpeed=0,this._mouseMoveAtPointerLock=function(t){e._mouseMovement.x+=t.movementX,e._mouseMovement.y+=t.movementY},t.addEvent(t.stage.elem,t.stage.elem,"mousemove",this._mouseMoveAtPointerLock)},pointerway:function(t){return this.speed(t),this.bind("EnterFrame",this._enterFrame),this},remove:function(){this.unbind("EnterFrame",this._enterFrame),t.removeEvent(t.stage.elem,t.stage.elem,"mousemove",this._mouseMoveAtPointerLock)},_enterFrame:function(){var t={x:this._x,y:this._y},e=this._mouseMovement.x,i=this._mouseMovement.y;this._mouseMovement.x=this._mouseMovement.y=0;var n=Math.hypot(e,i);n>this._speed.x&&(e=this._speed.x*(e/n),i=this._speed.x*(i/n)),this.x+=e,this.y+=i,this.x!==t.x&&this.y!==t.y&&this.trigger("Moved",t),this._callback&&this._callback()},callback:function(t){return console.log("registering callback",this,t),"function"==typeof t&&(this._callback=t.bind(this)),this},speed:function(t){return void 0!==t.x&&void 0!==t.y?(this._speed.x=t.x,this._speed.y=t.y):(this._speed.x=t,this._speed.y=t),this}}),t.c("Player",{init:function(){this.requires("Quark, Fourway, Persist"),this._previousFrames=[],this.z=1e3,this.color("rgb(7, 124, 190)"),this.fourway(3*n/4),this.onHit("Active",function(){t.scene("GameOver")}),this.onHit("Tachyon",function(e){this._tachId=e[0].obj.id,e.forEach(function(t){t.obj.destroy()}),t.scene("Scratch")}),this.unbind("EnterFrame",this._enterframe),this.bind("EnterFrame",function(){this._enterframe(),this.disableControls||this._collision()})},_collision:function(){this._x<s?this.x=s:this._x>e-this.w-s&&(this.x=e-this.w-s),this._y<s?this.y=s:this._y>i-this.h-s&&(this.y=i-this.h-s)},enableKeyboard:function(){this.removeComponent("PointerWay"),this.enableControl()},enableMouse:function(){var t=this;this.disableControl(),setTimeout(function(){t.addComponent("PointerWay").pointerway(n).callback(t._collision)},50)}})}},{}],35:[function(t,e,i){function n(t,e){return Math.atan2(-(e[1]-t[1]),e[0]-t[0])}function s(t,e){if(t>e){e+=2*Math.PI;for(var i=Math.random()*(e-t)+t;i<-Math.PI;)i+=2*Math.PI;for(;i>Math.PI;)i-=2*Math.PI;return i}return Math.random()*(e-t)+t}e.exports=function(t,e,i,r,o){t.c("Spawner",{_dt:0,_gameEnd:0,_tachId:0,init:function(){this._deadFrames=0,this._frames=[]},_enterFrame:function(){this._frames[this._dt]||(this._frames[this._dt]=this._generate()),this._spawn(this._frames[this._dt++])},_generate:function(){function t(t){function a(t){t.x=Math.random()*(e+2*f)-f,t.y=-f,_=[t.x,t.y],t.x<=r?(l=n(_,p.bottomLeft),d=n(_,p.topRight)):t.x>=e-r?(l=n(_,p.topLeft),d=n(_,p.bottomRight)):(l=n(_,p.topLeft),d=n(_,p.topRight)),t.angle=s(l,d)}function h(t){t.x=e+f,t.y=Math.random()*(i+2*f)-f,_=[t.x,t.y],t.y<=r?(l=n(_,p.topLeft),d=n(_,p.bottomRight)):t.y>=i-r?(l=n(_,p.topRight),d=n(_,p.bottomLeft)):(l=n(_,p.topLeft),d=n(_,p.bottomLeft)),t.angle=s(l,d)}function c(t){t.x=Math.random()*(e+2*f)-f,t.y=i+f,_=[t.x,t.y],t.x<=r?(l=n(_,p.bottomRight),d=n(_,p.topLeft)):t.x>=e-r?(l=n(_,p.topRight),d=n(_,p.bottomLeft)):(l=n(_,p.bottomRight),d=n(_,p.bottomLeft)),t.angle=s(l,d)}function u(t){t.x=-f,t.y=Math.random()*(i+2*f)-f,_=[t.x,t.y],t.y<=r?(l=n(_,p.bottomLeft),d=n(_,p.topRight)):t.y>=i-r?(l=n(_,p.bottomRight),d=n(_,p.topLeft)):(l=n(_,p.bottomLeft),d=n(_,p.topLeft)),t.angle=s(l,d)}var l,d,_,f=3*o/4,p={topLeft:[r,r],topRight:[e-r,r],bottomLeft:[r,i-r],bottomRight:[e-r,i-r]};switch(t.type){case"WhiteTachyon":var g=Math.floor(4*Math.random());switch(g){case 0:a(t);break;case 1:h(t);break;case 2:c(t);break;case 3:u(t);break;default:throw{name:"unknown side",value:g}}}}var a=[];if(this._deadFrames++<4)return a;this._deadFrames=0;for(var h=5*Math.random()+1,c=0;h>c;c++){var u=this._tachId++;a.push({type:"WhiteTachyon",id:u,speed:4})}return a.forEach(t),a},_spawn:function(e){e.forEach(function(e){switch(e.type){case"WhiteTachyon":t.e("WhiteTachyon").whiteTachyon(e.id,e.x,e.y,e.angle,e.speed)}})},spawner:function(t){return this._gameEnd=t,this},reset:function(){return this._dt=0,this.unbind("EnterFrame"),this},start:function(){return this.bind("EnterFrame",this._enterFrame),this}})}},{}],36:[function(t,e,i){e.exports=function(t,e,i,n,s,r){t.c("Tachyon",{init:function(){this.requires("2D, DOM, Color"),this.attr({w:r,h:r}),this.z=300}}),t.c("WhiteTachyon",{_angle:0,_speed:0,init:function(){this.requires("Tachyon"),this._movement={x:0,y:0},this.color("white")},_enterFrame:function(){return this._x<-s?void this.destroy():this._x>e-this.w+s?void this.destroy():this._y<-s?void this.destroy():this._y>i-this.h+s?void this.destroy():(this.x+=this._movement.x,void(this.y+=this._movement.y))},whiteTachyon:function(t,e,i,n,s){return this.id=t,this._angle=n,this._speed=s,this.x=e-Math.round(r/2),this.y=i-Math.round(r/2),this._movement.x=Math.cos(n)*s,this._movement.y=-Math.sin(n)*s,this.origin("center"),this.rotation=(Math.PI-n)*(180/Math.PI),this.bind("EnterFrame",this._enterFrame),this}})}},{}]},{},[32]);
